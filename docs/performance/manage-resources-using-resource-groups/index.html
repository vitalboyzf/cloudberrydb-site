<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-performance/manage-resources-using-resource-groups" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Resource Groups | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/performance/manage-resources-using-resource-groups"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Resource Groups | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="You can use resource groups to manage and protect the resource allocation of CPU, memory, concurrent transaction limits, and disk I/O in Apache Cloudberry. Once you define a resource group, you assign the group to one or more Apache Cloudberry roles, or to an external component such as PL/Container, in order to control the resources used by them."><meta data-rh="true" property="og:description" content="You can use resource groups to manage and protect the resource allocation of CPU, memory, concurrent transaction limits, and disk I/O in Apache Cloudberry. Once you define a resource group, you assign the group to one or more Apache Cloudberry roles, or to an external component such as PL/Container, in order to control the resources used by them."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/performance/manage-resources-using-resource-groups"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/performance/manage-resources-using-resource-groups" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/zh/docs/performance/manage-resources-using-resource-groups" hreflang="zh"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/performance/manage-resources-using-resource-groups" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.2a727248.css">
<script src="/assets/js/runtime~main.58241659.js" defer="defer"></script>
<script src="/assets/js/main.a0c0e24b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/contribute">Contribute</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/releases">Download</a><a class="navbar__item navbar__link" href="/support">Support</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/discussions/369" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/bootcamp">Bootcamp</a></li><li><a class="dropdown__link" href="/team">Team</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cbdb-macos-compile">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/basic-query-syntax">Operate with Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/performance/">Optimize Query Performance</a><button aria-label="Collapse sidebar category &#x27;Optimize Query Performance&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/update-stats-using-analyze">Update Statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-unique-index-on-ao-tables">Create Unique Index on AO Table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-auto-materialized-view-to-answer-queries">Use Auto Materialized Views for Query Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-incremental-materialized-view">Incremental Materialized View</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/parallel-create-ao-refresh-mv">Create AO/AOCO Tables and Refresh Materialized Views in Parallel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/parallel-query-execution">Parallel Queries Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-aggre-pushdown-to-speed-up-queries">Use Aggregation Pushdown to Speed Up Query Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-index-scan-on-ao-tables">Use IndexScan on AO Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-runtimefilter-to-optimize-queries">Use RuntimeFilter to Optimize Join Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance/use-columnar-compression">Use Column-Level Compression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/performance/manage-resources-using-resource-groups">Resource Groups</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/releases/">Releases</a><button aria-label="Expand sidebar category &#x27;Releases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" style="cursor:pointer">Optimize Query Performance</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Resource Groups</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Manage Resources Using Resource Groups</h1>
<p>You can use resource groups to manage and protect the resource allocation of CPU, memory, concurrent transaction limits, and disk I/O in Apache Cloudberry. Once you define a resource group, you assign the group to one or more Apache Cloudberry roles, or to an external component such as PL/Container, in order to control the resources used by them.</p>
<p>When you assign a resource group to a role, the resource limits that you define for the group apply to all of the roles to which you assign the group. For example, the memory limit for a resource group identifies the maximum memory usage for all running transactions submitted by Apache Cloudberry users in all roles to which you assign the group.</p>
<p>Apache Cloudberry uses Linux-based control groups for CPU resource management, and Runaway Detector for statistics, tracking and management of memory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="role-and-component-resource-groups">Role and component resource groups<a href="#role-and-component-resource-groups" class="hash-link" aria-label="Direct link to Role and component resource groups" title="Direct link to Role and component resource groups">​</a></h2>
<p>Apache Cloudberry supports two types of resource groups: groups that manage resources for roles, and groups that manage resources for external components such as PL/Container.</p>
<p>The most common application for resource groups is to manage the number of active queries that different roles might run concurrently in your Apache Cloudberry cluster. You can also manage the amount of CPU, memory resources, and disk I/O that Apache Cloudberry allocates to each query.</p>
<p>When a user runs a query, Apache Cloudberry evaluates the query against a set of limits defined for the resource group. Apache Cloudberry runs the query immediately if the group&#x27;s resource limits have not yet been reached and the query does not cause the group to exceed the concurrent transaction limit. If these conditions are not met, Apache Cloudberry queues the query. For example, if the maximum number of concurrent transactions for the resource group has already been reached, a subsequent query is queued and must wait until other queries complete before it runs. Apache Cloudberry might also run a pending query when the resource group&#x27;s concurrency and memory limits are altered to large enough values.</p>
<p>Within a resource group for roles, transactions are evaluated on a first in, first out basis. Apache Cloudberry periodically assesses the active workload of the system, reallocating resources and starting/queuing jobs as necessary.</p>
<p>You can also use resource groups to manage the CPU and memory resources of external components such as PL/Container. Resource groups for external components use Linux cgroups to manage the total CPU resources for the component.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-group-attributes-and-limits">Resource group attributes and limits<a href="#resource-group-attributes-and-limits" class="hash-link" aria-label="Direct link to Resource group attributes and limits" title="Direct link to Resource group attributes and limits">​</a></h2>
<p>When you create a resource group, you provide a set of limits that determine the amount of CPU and memory resources available to the group. The following table lists the available limits for resource groups:</p>
<table><thead><tr><th>Limit Type</th><th>Description</th><th>Value Range</th><th>Default</th></tr></thead><tbody><tr><td><code>CONCURRENCY</code></td><td>The maximum number of concurrent transactions, including active and idle transactions, that are permitted in the resource group.</td><td>[0, max_connections]</td><td>20</td></tr><tr><td><code>CPU_MAX_PERCENT</code></td><td>The maximum percentage of CPU resources the group can use.</td><td>[1, 100]</td><td>-1 (not set)</td></tr><tr><td><code>CPU_WEIGHT</code></td><td>The scheduling priority of the resource group.</td><td>[1, 500]</td><td>100</td></tr><tr><td><code>CPUSET</code></td><td>The specific CPU logical core (or logical thread in hyperthreading) reserved for this resource group.</td><td>It depends on system core configuration</td><td>-1</td></tr><tr><td><code>IO_LIMIT</code></td><td>The limit for the maximum read/write disk I/O throughput, and maximum read/write I/O operations per second. Set the value on a per-tablespace basis.</td><td>[2, 4294967295 or max]</td><td>-1</td></tr><tr><td><code>MEMORY_LIMIT</code></td><td>The memory limit value specified for the resource group.</td><td>Integer (MB)</td><td>-1 (not set, use <code>statement_mem</code> as the memory limit for a single query)</td></tr><tr><td><code>MIN_COST</code></td><td>The minimum cost of a query plan to be included in the resource group.</td><td>Integer</td><td>0</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Resource limits are not enforced on <code>SET</code>, <code>RESET</code>, and <code>SHOW</code> commands.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-concurrency-limit">Transaction concurrency limit<a href="#transaction-concurrency-limit" class="hash-link" aria-label="Direct link to Transaction concurrency limit" title="Direct link to Transaction concurrency limit">​</a></h3>
<p>The <code>CONCURRENCY</code> limit controls the maximum number of concurrent transactions permitted for a resource group.</p>
<p>Each resource group is logically divided into a fixed number of slots equal to the <code>CONCURRENCY</code> limit. Apache Cloudberry allocates these slots an equal, fixed percentage of memory resources.</p>
<p>The default <code>CONCURRENCY</code> limit value for a resource group for roles is 20. A value of 0 means that no query is allowed to run for this resource group.</p>
<p>Apache Cloudberry queues any transactions submitted after the resource group reaches its <code>CONCURRENCY</code> limit. When a running transaction completes, Apache Cloudberry un-queues and runs the earliest queued transaction if sufficient memory resources exist. Note that if a transaction is in <code>idle in transaction</code> state, even if no statement is running, the concurrency slot is still in use.</p>
<p>You can set the server configuration parameter <code>gp_resource_group_queuing_timeout</code> to specify the amount of time a transaction remains in the queue before Apache Cloudberry cancels the transaction. The default timeout is zero, Apache Cloudberry queues transactions indefinitely.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bypass-limits-and-unassign-from-resource-groups">Bypass limits and unassign from resource groups<a href="#bypass-limits-and-unassign-from-resource-groups" class="hash-link" aria-label="Direct link to Bypass limits and unassign from resource groups" title="Direct link to Bypass limits and unassign from resource groups">​</a></h3>
<p>A query bypasses the resource group concurrency limit if you set the server configuration parameter <code>gp_resource_group_bypass</code>. This parameter enables or disables the concurrent transaction limit for the resource group so a query can run immediately. The default value is false, which enforces the limit of the <code>CONCURRENCY</code> limit. You might only set this parameter for a single session, not within a transaction or a function. If you set <code>gp_resource_group_bypass</code> to true, the query no longer enforces the CPU or memory limits assigned to its resource group. Instead, the memory limit assigned to this query is <code>statement_mem</code> per query. If there is not enough memory to satisfy the memory allocation request, the query will fail.</p>
<p>You might bypass queries that only use catalog tables, such as the database Graphical User Interface (GUI) client, which runs catalog queries to obtain metadata. If the server configuration parameter <code>gp_resource_group_bypass_catalog_query</code> is set to true (the default), Apache Cloudberry&#x27;s resource group scheduler bypasses all queries that read exclusively from system catalogs, or queries that contain in their query text <code>pg_catalog</code> schema tables only. These queries are automatically unassigned from its current resource group; they do not enforce the limits of the resource group and do not account for resource usage. The query resources are assigned out of the resource groups and run immediately. The memory limit is <code>statement_mem</code> per the query.</p>
<p>You might bypass direct dispatch queries with the server configuration parameter <code>gp_resource_group_bypass_direct_dispatch</code>. A direct dispatch query is a special type of query that only requires a single segment to participate in the execution. In order to improve efficiency, Apache Cloudberry optimizes this type of query, using direct dispatch optimization. The system sends the query plan to the execution of a single segment that needs to execute the plan, instead of sending it to all segments for execution. If you set <code>gp_resource_group_bypass_direct_dispatch</code> to true, the query no longer enforces the CPU or memory limits assigned to its resource group, so it runs immediately. Instead, the memory limit assigned to this query is <code>statement_mem</code> per query. If there is not enough memory to satisfy the memory allocation request, the query will fail. You might only set this parameter for a single session, not within a transaction or a function.</p>
<p>Queries whose plan cost is less than the limit <code>MIN_COST</code> are automatically unassigned from their resource group and do not enforce any of its limits. The resources used by the query do not account for the resources of the resource group. The query has a memory limit of <code>statement_mem</code>. The default value of <code>MIN_COST</code> is 0.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-limits">CPU limits<a href="#cpu-limits" class="hash-link" aria-label="Direct link to CPU limits" title="Direct link to CPU limits">​</a></h3>
<p>Apache Cloudberry leverages Linux control groups to implement CPU resource management. Apache Cloudberry allocates CPU resources in two ways:</p>
<ul>
<li>By assigning a percentage of CPU resources to resource groups</li>
<li>By assigning specific CPU cores to resource groups</li>
</ul>
<p>When you set one of the allocation modes for a resource group, Apache Cloudberry deactivates the other allocation mode. You might employ both modes of CPU resource allocation simultaneously for different resource groups on the same Apache Cloudberry cluster. You might also change the CPU resource allocation mode for a resource group at runtime.</p>
<p>Apache Cloudberry uses the server configuration parameter <code>gp_resource_group_cpu_limit</code> to identify the maximum percentage of system CPU resources to allocate to resource groups on each Apache Cloudberry segment node. The remaining unreserved CPU resources are used for the operating system kernel and Apache Cloudberry daemons. The amount of CPU available to Apache Cloudberry queries per host is then divided equally among each segment on the Apache Cloudberry node.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The default <code>gp_resource_group_cpu_limit</code> value might not leave sufficient CPU resources if you are running other workloads on your Apache Cloudberry cluster nodes, so be sure to adjust this server configuration parameter accordingly.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Avoid setting <code>gp_resource_group_cpu_limit</code> to a value higher than <code>.9</code>. Doing so might result in high workload queries taking near all CPU resources, potentially starving Apache Cloudberry auxiliary processes.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-cpu-resources-by-core">Assign CPU resources by core<a href="#assign-cpu-resources-by-core" class="hash-link" aria-label="Direct link to Assign CPU resources by core" title="Direct link to Assign CPU resources by core">​</a></h4>
<p>You identify the CPU cores that you want to reserve for a resource group with the <code>CPUSET</code> property. The CPU cores that you specify must be available in the system and cannot overlap with any CPU cores that you reserved for other resource groups. Although Apache Cloudberry uses the cores that you assign to a resource group exclusively for that group, note that those CPU cores might also be used by non-Apache Cloudberry processes in the system. When you configure <code>CPUSET</code> for a resource group, Apache Cloudberry deactivates <code>CPU_MAX_PERCENT</code> and <code>CPU_WEIGHT</code> for the group and sets their value to -1.</p>
<p>Specify CPU cores separately for the coordinator host and segment hosts, separated by a semicolon. Use a comma-separated list of single core numbers or number intervals when you configure cores for <code>CPUSET</code>. You must enclose the core numbers/intervals in single quotes, for example, <code>&#x27;1;1,3-4&#x27;</code> uses core 1 on the coordinator host, and cores 1, 3, and 4 on segment hosts.</p>
<p>When you assign CPU cores to <code>CPUSET</code> groups, consider the following:</p>
<ul>
<li>A resource group that you create with <code>CPUSET</code> uses the specified cores exclusively. If there are no running queries in the group, the reserved cores are idle and cannot be used by queries in other resource groups. Consider minimizing the number of <code>CPUSET</code> groups to avoid wasting system CPU resources.</li>
<li>Consider keeping CPU core 0 unassigned. CPU core 0 is used as a fallback mechanism in the following cases:<!-- -->
<ul>
<li><code>admin_group</code> and <code>default_group</code> require at least one CPU core. When all CPU cores are reserved, Apache Cloudberry assigns CPU core 0 to these default groups. In this situation, the resource group to which you assigned CPU core 0 shares the core with <code>admin_group</code> and <code>default_group</code>.</li>
<li>If you restart your Apache Cloudberry cluster with one node replacement and the node does not have enough cores to service all <code>CPUSET</code> resource groups, the groups are automatically assigned CPU core 0 to avoid system start failure.</li>
</ul>
</li>
<li>Use the lowest possible core numbers when you assign cores to resource groups. If you replace a Apache Cloudberry node and the new node has fewer CPU cores than the original, or if you back up the database and want to restore it on a cluster with nodes with fewer CPU cores, the operation might fail. For example, if your Apache Cloudberry cluster has 16 cores, assigning cores 1-7 is optimal. If you create a resource group and assign CPU core 9 to this group, database restore to an 8 core node will fail.</li>
</ul>
<p>Resource groups that you configure with <code>CPUSET</code> have a higher priority on CPU resources. The maximum CPU resource usage percentage for all resource groups configured with <code>CPUSET</code> on a segment host is the number of CPU cores reserved divided by the number of all CPU cores, multiplied by 100.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You must configure <code>CPUSET</code> for a resource group <em>after</em> you have enabled resource group-based resource management for your Apache Cloudberry cluster with the <code>gp_resource_manager</code> server configuration parameter.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-cpu-resources-by-percentage">Assign CPU resources by percentage<a href="#assign-cpu-resources-by-percentage" class="hash-link" aria-label="Direct link to Assign CPU resources by percentage" title="Direct link to Assign CPU resources by percentage">​</a></h4>
<p>You configure a resource group with <code>CPU_MAX_PERCENT</code> in order to assign CPU resources by percentage. When you configure <code>CPU_MAX_PERCENT</code> for a resource group, Apache Cloudberry deactivates <code>CPUSET</code> for the group.</p>
<p>The parameter <code>CPU_MAX_PERCENT</code> sets a hard upper limit for the percentage of the segment CPU for resource management. The minimum <code>CPU_MAX_PERCENT</code> percentage you can specify for a resource group is 1, the maximum is 100. The sum of <code>CPU_MAX_PERCENT</code>s specified for all resource groups that you define in your Apache Cloudberry cluster can exceed 100. It specifies the total time ratio that all tasks in a resource group can run in a given CPU time period. Once the tasks in the resource group have used up all the time specified by the limit, they are throttled for the remainder of the time specified in that time period, and are not allowed to run until the next time period.</p>
<p>When tasks in a resource group are idle and not using any CPU time, the leftover time is collected in a global pool of unused CPU cycles. Other resource groups can borrow CPU cycles from this pool. The actual amount of CPU time available to a resource group might vary, depending on the number of resource groups present on the system.</p>
<p>The parameter <code>CPU_MAX_PERCENT</code> enforces a hard upper limit of CPU usage. For example, if it is set to 40%, it indicates that although the resource group can temporarily use some idle CPU resources from other groups, the maximum it can use is 40% of the CPU resources available to Apache Cloudberry.</p>
<p>You set the parameter <code>CPU_WEIGHT</code> to assign the scheduling priority of the current group. The default value is 100, and the range of values is 1 to 500. The value specifies the relative share of CPU time available to tasks in the resource group. For example, if one resource group has a relative share of 100 and another two groups have a relative share of 50, when processes in all the resource groups try to use 100% of the CPU (that means, the value of <code>CPU_MAX_PERCENT</code> for all groups is set to 100), the first resource group gets 50% of all CPU time, and the other two get 25% each. However, if you add another group with a relative share of 100, the first group is only allowed to use 33% of the CPU, and the remaining groups get 16.5%, 16.5%, and 33% respectively.</p>
<p>For example, consider the following groups:</p>
<table><thead><tr><th>Group Name</th><th>CONCURRENCY</th><th>CPU_MAX_PERCENT</th><th>CPU_WEIGHT</th></tr></thead><tbody><tr><td>default_group</td><td>20</td><td>50</td><td>10</td></tr><tr><td>admin_group</td><td>10</td><td>70</td><td>30</td></tr><tr><td>system_group</td><td>10</td><td>30</td><td>10</td></tr><tr><td>test</td><td>10</td><td>10</td><td>10</td></tr></tbody></table>
<p>Roles in <code>default_group</code> have an available CPU ratio (determined by <code>CPU_WEIGHT</code>) of 10/(10+30+10+10)=16%. This means that they can use at least 16% of the CPU when the system workload is high. When the system has idle CPU resources, they can use more resources, as the hard limit (set by <code>CPU_MAX_PERCENT</code>) is 50%.</p>
<p>Roles in <code>admin_group</code> have an available CPU ratio of 30/(10+30+10+10)=50% when the system workload is high. When the system has idle CPU resources, they can use resources up to the hard limit of 70%.</p>
<p>Roles in <code>test</code> have a CPU ratio of 10/(10+30+10+10)=16%. However, as the hard limit determined by <code>CPU_MAX_PERCENT</code> is 10%, they can only use up to 10% of the resources even when the system is idle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-limits">Memory limits<a href="#memory-limits" class="hash-link" aria-label="Direct link to Memory limits" title="Direct link to Memory limits">​</a></h3>
<p>When you enable resource groups, memory usage is managed at the Apache Cloudberry segment and resource group levels. You can also manage memory at the transaction level.</p>
<p>The amount of memory allocated to a query is determined by the following parameters:</p>
<p>The parameter <code>MEMORY_LIMIT</code> of a resource group sets the maximum amount of memory reserved for this resource group on a segment. This determines the total amount of memory that all worker processes for a query can consume on the segment host during query execution. The amount of memory allotted to a query is the group memory limit divided by the group concurrency limit: <code>MEMORY_LIMIT</code> / <code>CONCURRENCY</code>.</p>
<p>If a query requires a large amount of memory, you might use the server configuration parameter <code>gp_resgroup_memory_query_fixed_mem</code> to set a fixed memory amount for the query at the session level. This parameter overrides and can surpass the allocated memory of the resource group.</p>
<p>Apache Cloudberry allocates memory for an incoming query using the <code>gp_resgroup_memory_query_fixed_mem</code> value, if set, to bypass the resource group settings. Otherwise, it uses <code>MEMORY_LIMIT</code> / <code>CONCURRENCY</code> as the memory allocated for the query. If <code>MEMORY_LIMIT</code> is not set, the value for the query memory allocation defaults to <code>statement_mem</code>.</p>
<p>For all queries, if there is not enough memory in the system, they spill to disk. When the limit <code>gp_workfile_limit_files_per_query</code> is reached, Apache Cloudberry generates an out of memory (OOM) error.</p>
<p>For example, consider a resource group named <code>adhoc</code> with <code>MEMORY_LIMIT</code> set to 1.5 GB and <code>CONCURRENCY</code> set to <code>3</code>. By default, each statement submitted to the group is allocated 500 MB of memory. Now consider the following series of events:</p>
<ol>
<li>
<p>User <code>ADHOC_1</code> submits query <code>Q1</code>, overriding <code>gp_resgroup_memory_query_fixed_mem</code> to 800MB. The <code>Q1</code> statement is admitted into the system.</p>
</li>
<li>
<p>User <code>ADHOC_2</code> submits query <code>Q2</code>, using the default 500MB.</p>
</li>
<li>
<p>With <code>Q1</code> and <code>Q2</code> still running, user <code>ADHOC3</code> submits query <code>Q3</code>, using the default 500MB.</p>
<p>Queries <code>Q1</code> and <code>Q2</code> have used 1300MB of the group&#x27;s 1500MB. However, if there is enough system memory available for query <code>Q3</code> in the segment at that time, it can run normally.</p>
</li>
<li>
<p>User <code>ADHOC4</code> submits query <code>Q4</code>, using <code>gp_resgroup_memory_query_fixed_mem</code> set to 700 MB.</p>
<p>Query <code>Q4</code> runs immediately as it bypasses the resource group limits.</p>
</li>
</ol>
<p>There are some special usage considerations regarding memory limits:</p>
<ul>
<li>If you set the configuration parameters <code>gp_resource_group_bypass</code> or <code>gp_resource_group_bypass_catalog_query</code> to bypass the resource group limits, the memory limit for the query takes the value of <code>statement_mem</code>.</li>
<li>When (<code>MEMORY_LIMIT</code> / <code>CONCURRENCY</code>) &lt; <code>statement_mem</code>, Apache Cloudberry uses <code>statement_mem</code> as the fixed amount of memory allocated by query.</li>
<li>The maximum value of <code>statement_mem</code> is capped at <code>max_statement_mem</code>.</li>
<li>Queries whose plan cost is less than the limit <code>MIN_COST</code> use a memory limit of <code>statement_mem</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disk-io-limits">Disk I/O limits<a href="#disk-io-limits" class="hash-link" aria-label="Direct link to Disk I/O limits" title="Direct link to Disk I/O limits">​</a></h3>
<p>Apache Cloudberry leverages Linux control groups to implement disk I/O limits. The parameter <code>IO_LIMIT</code> limits the maximum read/write disk I/O throughput, and the maximum read/write I/O operations per second for the queries assigned to a specific resource group. It allocates bandwidth, ensures the use of high-priority resource groups, and avoids excessive use of disk bandwidth. The value of the parameter is set on a per-tablespace basis.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Disk I/O limits are only available when you use Linux Control Groups v2.</p></div></div>
<p>When you limit disk I/O you specify:</p>
<ul>
<li>The tablespace name or the tablespace object ID (OID) you set the limits for. Use <code>*</code> to set limits for all tablespaces.</li>
<li>The values for <code>rbps</code> and <code>wbps</code> to limit the maximum read and write disk I/O throughput in the resource group, in MB/sec. The default value is <code>max</code>, which means there is no limit.</li>
<li>The values for <code>riops</code> and <code>wiops</code> to limit the maximum read and write I/O operations per second in the resource group. The default value is <code>max</code>, which means there is no limit.</li>
</ul>
<p>If the parameter <code>IO_LIMIT</code> is not set, the default value for <code>rbps</code>, <code>wpbs</code>, <code>riops</code>, and <code>wiops</code>s is set to <code>max</code>, which means that there are no disk I/O limits. In this scenario, the <code>gp_toolkit.gp_resgroup_config</code> system view displays its value as <code>-1</code>. If only some of the values of <code>IO_LIMIT</code> are set (for example. <code>rbps</code>), the parameters that are not set default to <code>max</code> (in this example, <code>wbps</code>, <code>riops</code>, <code>wiops</code>).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-use-resource-groups">Configure and use resource groups<a href="#configure-and-use-resource-groups" class="hash-link" aria-label="Direct link to Configure and use resource groups" title="Direct link to Configure and use resource groups">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p>Apache Cloudberry resource groups use Linux Control Groups (cgroups) to manage CPU resources and disk I/O. There are two versions of cgroups: cgroup v1 and cgroup v2. Apache Cloudberry supports both versions, but it only supports the parameter <code>IO_LIMIT</code> for cgroup v2. The version of Linux Control Groups shipped by default with your Linux distribution depends on the operating system version. For Enterprise Linux 8 and older, the default version is v1. For Enterprise Linux 9 and later, the default version is v2.</p>
<p>Verify what version of cgroup is configured in your environment by checking what filesystem is mounted by default during system boot:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">stat -fc %T /sys/fs/cgroup/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For cgroup v1, the output is <code>tmpfs</code>. For cgroup v2, output is <code>cgroup2fs</code>.</p>
<p>You do not need to change your version of cgroup, you can simply skip to <code>optimize-performance/manage-resources-using-resource-groups:configure cgroup v1</code> or <code>optimize-performance/manage-resources-using-resource-groups:configure cgroup v2</code> in order to complete the configuration prerequisites.</p>
<p>However, if you prefer to switch from cgroup v1 to v2, run the following commands as root:</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you are using an older version of CentOS, such as Centos 7.x or earlier, you will only be able to use the default <code>cgroup v1</code> control groups; if you are using Centos 8.x, you can follow the steps below to switch the control group from v1 to v2.</p></div></div>
<ul>
<li>
<p>Red Hat 8/Rocky 8/Oracle 8 systems:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args=&quot;systemd.unified_cgroup_hierarchy=1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Ubuntu systems:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">vim /etc/default/grub     # add or modify: GRUB_CMDLINE_LINUX=&quot;systemd.unified_cgroup_hierarchy=1&quot;     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">update-grub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>If you want to switch from cgroup v2 to v1, run the following commands as root:</p>
<ul>
<li>
<p>Red Hat 8/Rocky 8/Oracle 8 systems:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args=&quot;systemd.unified_cgroup_hierarchy=0 systemd.legacy_systemd_cgroup_controller&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Ubuntu systems:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">vim /etc/default/grub     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># add or modify: GRUB_CMDLINE_LINUX=&quot;systemd.unified_cgroup_hierarchy=0&quot;     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">update-grub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>After that, reboot your host in order for the changes to take effect.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-cgroup-v1">Configure cgroup v1<a href="#configure-cgroup-v1" class="hash-link" aria-label="Direct link to Configure cgroup v1" title="Direct link to Configure cgroup v1">​</a></h4>
<p>Complete the following tasks on each node in your Apache Cloudberry cluster to set up cgroups v1 for use with resource groups:</p>
<ol>
<li>
<p>Install <code>libcgroup</code> and <code>libcgroup-tools</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo yum install libcgroup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo yum install libcgroup-tools      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Locate the cgroups configuration file <code>/etc/cgconfig.conf</code>. You must be the superuser or have <code>sudo</code> access to edit this file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">vi /etc/cgconfig.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Add the following configuration information to the file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">group gpdb {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     perm {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         task {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             uid = gpadmin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             gid = gpadmin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         admin {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             uid = gpadmin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             gid = gpadmin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     cpu {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     cpuacct {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     cpuset {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     memory {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This content configures CPU, CPU accounting, CPU core set, and memory control groups managed by the <code>gpadmin</code> user. Apache Cloudberry uses the memory control group only for monitoring the memory usage.</p>
</li>
<li>
<p>Start the cgroups service on each Apache Cloudberry node. For Redhat/Oracle/Rocky 8.x and older, run the following as root:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cgconfigparser -l /etc/cgconfig.conf </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>To automatically recreate Apache Cloudberry required cgroup hierarchies and parameters when your system is restarted, configure your system to enable the Linux cgroup service daemon <code>cgconfig.service</code> at node start-up. To ensure the configuration is persisten after reboot, run the following commands as user root. For Redhat/Oracle/Rocky 8.x and older:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable cgconfig.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To start the service immediately (without having to reboot) enter:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl start cgconfig.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Identify the <code>cgroup</code> directory mount point for the node. For Redhat/Oracle/Rocky 8.x and older, run the following as root:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">grep cgroup /proc/mounts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first line of output identifies the <code>cgroup</code> mount point.</p>
</li>
<li>
<p>Verify that you set up the Apache Cloudberry cgroups configuration correctly by running the following commands. Replace <code>&lt;cgroup_mount_point&gt;</code> with the mount point that you identified in the previous step:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls -l &lt;cgroup_mount_point&gt;/cpu/gpdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls -l &lt;cgroup_mount_point&gt;/cpuset/gpdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls -l &lt;cgroup_mount_point&gt;/memory/gpdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If these directories exist and are owned by <code>gpadmin:gpadmin</code>, you have successfully configured cgroups for Apache Cloudberry resource management.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-cgroup-v2">Configure cgroup v2<a href="#configure-cgroup-v2" class="hash-link" aria-label="Direct link to Configure cgroup v2" title="Direct link to Configure cgroup v2">​</a></h4>
<ol>
<li>
<p>Configure the system to mount <code>cgroups-v2</code> by default during system boot by the <code>systemd</code> system and service manager as user root.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Reboot the system for the changes to take effect. <code>reboot now</code></p>
</li>
<li>
<p>Create the directory <code>/sys/fs/cgroup/gpdb</code>, add all the necessary controllers, and ensure <code>gpadmin</code> user has read and write permission on it.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /sys/fs/cgroup/gpdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;+cpuset +io +cpu +memory&quot; | tee -a /sys/fs/cgroup/cgroup.subtree_control</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">chown -R gpadmin:gpadmin /sys/fs/cgroup/gpdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>You might encounter the error <code>Invalid argument</code> after running the above commands. This is because cgroups v2 do not support control of real-time processes, and the <code>cpu</code> controller can only be enabled when all the real-time processes are in the root cgroup. In this situation, find all real-time processes and move them to the root cgroup before you re-enable the controllers.</p>
<ol>
<li>
<p>Ensure that <code>gpadmin</code> has write permission on <code>/sys/fs/cgroup/cgroup.procs</code>. This is required to move the Apache Cloudberry processes from the user slices to <code>/sys/fs/cgroup/gpdb/</code> after the cluster is started in order to manage the postmaster services and all its auxiliary processes.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chmod a+w /sys/fs/cgroup/cgroup.procs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Because resource groups manually manage cgroup files, the above settings will become ineffective after a system reboot. Add the following bash script for systemd so it runs automatically during system startup. Perform the following steps as user root:</p>
</li>
<li>
<p>Create <code>gpdb.service</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">vim /etc/systemd/system/gpdb.service </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Write the following content into <code>gpdb.service</code>, if the user is not <code>gpadmin</code>, replace it with the appropriate user.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Description=Apache Cloudberry Cgroup v2 Configuration Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WorkingDirectory=/sys/fs/cgroup/gpdb.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Delegate=yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Slice=-.slice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># set hierarchies only if cgroup v2 mounted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecCondition=bash -c &#x27;[ xcgroup2fs = x$(stat -fc &quot;%%T&quot; /sys/fs/cgroup) ] || exit 1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecStartPre=bash -ec &quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">chown -R gpadmin:gpadmin .; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">chmod a+w ../cgroup.procs; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p helper.scope&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecStart=sleep infinity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecStartPost=bash -ec &quot;echo $MAINPID &gt; ./helper.scope/cgroup.procs;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WantedBy=basic.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Reload systemd daemon and enable the service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable gpdb.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-resource-groups">Enable resource groups<a href="#enable-resource-groups" class="hash-link" aria-label="Direct link to Enable resource groups" title="Direct link to Enable resource groups">​</a></h2>
<p>When you install Apache Cloudberry, no resource management policy is enabled by default. To use resource groups, set the <code>gp_resource_manager</code> server configuration parameter.</p>
<ol>
<li>
<p>Set the <code>gp_resource_manager</code> server configuration parameter to the value <code>&quot;group&quot;</code> or <code>&quot;group-v2&quot;</code>, depending on the version of cgroup configured on your Linux distribution. For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpconfig -c gp_resource_manager -v &quot;group&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpconfig -c gp_resource_manager -v &quot;group-v2&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Restart Apache Cloudberry:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpstop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpstart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>Once enabled, any transaction submitted by a role is directed to the resource group assigned to the role, and is governed by that resource group&#x27;s concurrency, memory, CPU, and disk I/O limits.</p>
<p>Apache Cloudberry creates three default resource groups for roles named <code>admin_group</code>, <code>default_group</code>, and <code>system_group</code>. When you enable resources groups, any role that was not explicitly assigned a resource group is assigned the default group for the role&#x27;s capability. <code>SUPERUSER</code> roles are assigned the <code>admin_group</code>, non-admin roles are assigned the group named <code>default_group</code>. The resources of the Apache Cloudberry system processes are assigned to the <code>system_group</code>. You cannot manually assign any roles to the <code>system_group</code>.</p>
<p>Use the following command to retrieve details of all the resource groups, including the default resource groups <code>admin_group</code>, <code>default_group</code>, and <code>system_group</code>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-resource-groups">Create resource groups<a href="#create-resource-groups" class="hash-link" aria-label="Direct link to Create resource groups" title="Direct link to Create resource groups">​</a></h2>
<p>When you create a resource group for a role, you provide a name and a CPU resource allocation mode (core or percentage). You can optionally provide a concurrent transaction limit, a memory limit, a CPU soft priority, disk I/O limits, and a minimum cost. Use the <code>CREATE RESOURCE GROUP</code> command to create a new resource group.</p>
<p>When you create a resource group for a role, you must provide a <code>CPU_MAX_PERCENT</code> or <code>CPUSET</code> limit value. These limits identify the percentage of Apache Cloudberry CPU resources to allocate to this resource group. You might specify a <code>MEMORY_LIMIT</code> to reserve a fixed amount of memory for the resource group.</p>
<p>For example, to create a resource group named <em>rgroup1</em> with a CPU limit of 20, a memory limit of 25, a CPU soft priority of 500, a minimum cost of 50, and disk I/O limits for the <code>pg_default</code> tablespace:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> rgroup1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">CONCURRENCY</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CPU_MAX_PERCENT</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> MEMORY_LIMIT</span><span class="token operator">=</span><span class="token number">250</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CPU_WEIGHT</span><span class="token operator">=</span><span class="token number">500</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> MIN_COST</span><span class="token operator">=</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IO_LIMIT</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;pg_default: wbps=1000, rbps=1000, wiops=100, riops=100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you use <code>cgroup v1</code> but specified IO_LIMIT. The resource group would still be created but with the following warning: &quot;resource group io limit only can be used in cgroup v2&quot;.</p></div></div>
<p>The CPU limit of 20 is shared by every role to which <code>rgroup1</code> is assigned. Similarly, the memory limit of 25 is shared by every role to which <code>rgroup1</code> is assigned. <code>rgroup1</code> utilizes the default <code>CONCURRENCY</code> setting of 20.</p>
<p>The <code>ALTER RESOURCE GROUP</code> command updates the limits of a resource group. To change the limits of a resource group, specify the new values that you want for the group. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> rg_role_light </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> CONCURRENCY </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">exec</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> MEMORY_LIMIT </span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> rgroup1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> CPUSET </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1;2,4&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> sales </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> IO_LIMIT </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;tablespace1:wbps=2000,wiops=2000;tablespace2:rbps=2024,riops=2024&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You cannot set or alter the <code>CONCURRENCY</code> value for the <code>admin_group</code> to zero (0).</p></div></div>
<p>The <code>DROP RESOURCE GROUP</code> command drops a resource group. To drop a resource group for a role, the group cannot be assigned to any role, nor can there be any transactions active or waiting in the resource group.</p>
<p>To drop a resource group:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DROP</span><span class="token plain"> RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">exec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-automatic-query-termination-based-on-memory-usage">Configure automatic query termination based on memory usage<a href="#configure-automatic-query-termination-based-on-memory-usage" class="hash-link" aria-label="Direct link to Configure automatic query termination based on memory usage" title="Direct link to Configure automatic query termination based on memory usage">​</a></h2>
<p>Apache Cloudberry supports the Runaway detector, which automatically terminates queries based on the amount of memory used by the query. For resource group-managed queries, Apache Cloudberry terminates a running query based on the amount of memory used by the query. The relevant configuration parameters are:</p>
<ul>
<li><code>gp_vmem_protect_limit</code> sets the amount of memory that all <code>postgres</code> processes of the active segment instance can consume. If a query causes this limit to be exceeded, no memory will be allocated and the query will fail.</li>
<li><code>runaway_detector_activation_percent</code> When resource groups are enabled, if the used memory exceeds the specified value <code>gp_vmem_protect_limit</code> * <code>runaway_detector_activation_percent</code>, Apache Cloudberry terminates queries based on memory usage, selecting queries from the queries managed by user resource groups (excluding those in the <code>system_group</code> resource group). Apache Cloudberry starts with the query that consumes the largest amount of memory. The query will terminate until the percentage of memory used falls below the specified percentage.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="assign-a-resource-group-to-a-role">Assign a resource group to a role<a href="#assign-a-resource-group-to-a-role" class="hash-link" aria-label="Direct link to Assign a resource group to a role" title="Direct link to Assign a resource group to a role">​</a></h2>
<p>You assign a resource group to a database role using the <code>RESOURCE GROUP</code> clause of the <code>CREATE ROLE</code> or <code>ALTER ROLE</code> commands. If you do not specify a resource group for a role, the role is assigned the default group for the role&#x27;s capability. <code>SUPERUSER</code> roles are assigned the <code>admin_group</code>, non-admin roles are assigned the group named <code>default_group</code>.</p>
<p>Use the <code>ALTER ROLE</code> or <code>CREATE ROLE</code> commands to assign a resource group to a role. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> ROLE bill RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> rg_light</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> ROLE mary RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">exec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can assign a resource group to one or more roles. If you have defined a role hierarchy, assigning a resource group to a parent role does not propagate down to the members of that role group.</p>
<p>If you wish to remove a resource group assignment from a role and assign the role the default group, change the role&#x27;s group name assignment to <code>NONE</code>. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> ROLE mary RESOURCE </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">GROUP</span><span class="token plain"> NONE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-resource-group-status">Monitor resource group status<a href="#monitor-resource-group-status" class="hash-link" aria-label="Direct link to Monitor resource group status" title="Direct link to Monitor resource group status">​</a></h2>
<p>Monitoring the status of your resource groups and queries might involve the following tasks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-resource-group-limits">View resource group limits<a href="#view-resource-group-limits" class="hash-link" aria-label="Direct link to View resource group limits" title="Direct link to View resource group limits">​</a></h3>
<p>The <code>gp_resgroup_config</code> <code>gp_toolkit</code> system view displays the current limits for a resource group. To view the limits of all resource groups:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-resource-group-query-status">View resource group query status<a href="#view-resource-group-query-status" class="hash-link" aria-label="Direct link to View resource group query status" title="Direct link to View resource group query status">​</a></h3>
<p>The <code>gp_resgroup_status</code> <code>gp_toolkit</code> system view enables you to view the status and activity of a resource group. The view displays the number of running and queued transactions. To view this information:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-resource-group-memory-usage-per-host">View resource group memory usage per host<a href="#view-resource-group-memory-usage-per-host" class="hash-link" aria-label="Direct link to View resource group memory usage per host" title="Direct link to View resource group memory usage per host">​</a></h3>
<p>The <code>gp_resgroup_status_per_host</code> <code>gp_toolkit</code> system view enables you to view the real-time memory usage of a resource group on a per-host basis. To view this information:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_status_per_host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-resource-group-assigned-to-a-role">View the resource group assigned to a role<a href="#view-the-resource-group-assigned-to-a-role" class="hash-link" aria-label="Direct link to View the resource group assigned to a role" title="Direct link to View the resource group assigned to a role">​</a></h3>
<p>To view the resource group-to-role assignments, perform the following query on the <code>pg_roles</code> and <code>pg_resgroup</code> system catalog tables:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> rolname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rsgname </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pg_resgroup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rolresgroup</span><span class="token operator">=</span><span class="token plain">pg_resgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">oid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-resource-group-disk-io-usage-per-host">View resource group disk I/O usage per host<a href="#view-resource-group-disk-io-usage-per-host" class="hash-link" aria-label="Direct link to View resource group disk I/O usage per host" title="Direct link to View resource group disk I/O usage per host">​</a></h3>
<p>The <code>gp_resgroup_iostats_per_host</code> <code>gp_toolkit</code> system view enables you to view the real-time disk I/O usage of a resource group on a per-host basis. To view this information:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_iostats_per_host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-a-resource-groups-running-and-pending-queries">View a resource group&#x27;s running and pending queries<a href="#view-a-resource-groups-running-and-pending-queries" class="hash-link" aria-label="Direct link to View a resource group&#x27;s running and pending queries" title="Direct link to View a resource group&#x27;s running and pending queries">​</a></h3>
<p>To view a resource group&#x27;s running queries, pending queries, and how long the pending queries have been queued, examine the <code>pg_stat_activity</code> system catalog table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rsgname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">wait_event_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> wait_event </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> pg_stat_activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>pg_stat_activity</code> displays information about the user/role that initiated a query. A query that uses an external component such as PL/Container is composed of two parts: the query operator that runs in Apache Cloudberry and the UDF that runs in a PL/Container instance. Apache Cloudberry processes the query operators under the resource group assigned to the role that initiated the query. A UDF running in a PL/Container instance runs under the resource group assigned to the PL/Container runtime. The latter is not represented in the <code>pg_stat_activity</code> view; Apache Cloudberry does not have any insight into how external components such as PL/Container manage memory in running instances.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancel-a-running-or-queued-transaction-in-a-resource-group">Cancel a running or queued transaction in a resource group<a href="#cancel-a-running-or-queued-transaction-in-a-resource-group" class="hash-link" aria-label="Direct link to Cancel a running or queued transaction in a resource group" title="Direct link to Cancel a running or queued transaction in a resource group">​</a></h3>
<p>There might be cases when you want to cancel a running or queued transaction in a resource group. For example, you might want to remove a query that is waiting in the resource group queue but has not yet been run. Or, you might want to stop a running query that is taking too long to run, or one that is sitting idle in a transaction and taking up resource group transaction slots that are needed by other users.</p>
<p>By default, transactions can remain queued in a resource group indefinitely. If you want Apache Cloudberry to cancel a queued transaction after a specific amount of time, set the server configuration parameter <code>gp_resource_group_queuing_timeout</code>. When this parameter is set to a value (milliseconds) greater than 0, Apache Cloudberry cancels any queued transaction when it has waited longer than the configured timeout.</p>
<p>To manually cancel a running or queued transaction, you must first determine the process id (pid) associated with the transaction. Once you have obtained the process id, you can invoke <code>pg_cancel_backend()</code> to end that process, as shown below.</p>
<p>For example, to view the process information associated with all statements currently active or waiting in all resource groups, run the following query. If the query returns no results, then there are no running or queued transactions in any resource group.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> rolname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> g</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rsgname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> waiting</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> datname </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> gp_toolkit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">gp_resgroup_status g</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pg_stat_activity </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> pg_roles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rolresgroup</span><span class="token operator">=</span><span class="token plain">g</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">groupid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">AND</span><span class="token plain"> pg_stat_activity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">usename</span><span class="token operator">=</span><span class="token plain">pg_roles</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rolname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample partial query output:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rolname </span><span class="token operator">|</span><span class="token plain"> rsgname  </span><span class="token operator">|</span><span class="token plain"> pid     </span><span class="token operator">|</span><span class="token plain"> waiting </span><span class="token operator">|</span><span class="token plain"> state  </span><span class="token operator">|</span><span class="token plain">          query           </span><span class="token operator">|</span><span class="token plain"> datname </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">---------+----------+---------+---------+--------+------------------------ -+---------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> sammy  </span><span class="token operator">|</span><span class="token plain"> rg_light </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">31861</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">    f    </span><span class="token operator">|</span><span class="token plain"> idle   </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> mytesttbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> testdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> billy  </span><span class="token operator">|</span><span class="token plain"> rg_light </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">31905</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">    t    </span><span class="token operator">|</span><span class="token plain"> active </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> topten</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">    </span><span class="token operator">|</span><span class="token plain"> testdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use this output to identify the process id (<code>pid</code>) of the transaction you want to cancel, and then cancel the process. For example, to cancel the pending query identified in the sample output above:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> pg_cancel_backend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">31905</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can provide an optional message in a second argument to <code>pg_cancel_backend()</code> to indicate to the user why the process was cancelled.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Do not use an operating system <code>KILL</code> command to cancel any Apache Cloudberry process.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="move-a-query-to-a-different-resource-group">Move a query to a different resource group<a href="#move-a-query-to-a-different-resource-group" class="hash-link" aria-label="Direct link to Move a query to a different resource group" title="Direct link to Move a query to a different resource group">​</a></h2>
<p>A user with Apache Cloudberry superuser privileges can run the <code>gp_toolkit.pg_resgroup_move_query()</code> function to move a running query from one resource group to another, without stopping the query. Use this function to expedite a long-running query by moving it to a resource group with a higher resource allotment or availability.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You can move only an active or running query to a new resource group. You cannot move a queued or pending query that is in an idle state due to concurrency or memory limits.</p></div></div>
<p><code>pg_resgroup_move_query()</code> requires the process id (pid) of the running query, as well as the name of the resource group to which you want to move the query. The signature of the function follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pg_resgroup_move_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> pid int4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> group_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">text</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can obtain the pid of a running query from the <code>pg_stat_activity</code> system view as described in <code>optimize-performance/manage-resources-using-resource-groups:cancel a running or queued transaction in a resource group</code>. Use the <code>gp_toolkit.gp_resgroup_status</code> view to list the name, id, and status of each resource group.</p>
<p>When you invoke <code>pg_resgroup_move_query()</code>, the query is subject to the limits configured for the destination resource group:</p>
<ul>
<li>If the group has already reached its concurrent task limit, Apache Cloudberry queues the query until a slot opens or for <code>gp_resource_group_queuing_timeout</code> milliseconds if set.</li>
<li>If the group has a free slot, <code>pg_resgroup_move_query()</code> tries to give slot control away to the target process for up to <code>gp_resource_group_move_timeout</code> milliseconds. If target process can&#x27;t handle movement request until <code>gp_resource_group_queuing_timeout</code> exceeds, Apache Cloudberry returns the error: <code>target process failed to move to a new group</code>.</li>
<li>If <code>pg_resgroup_move_query()</code> was cancelled, but target process already got all slot controls, segment&#x27;s processes will not be moved to new group, and target process will hold the slot. Such inconsistent state will be fixed by the end of transaction or by any next command dispatched by target process inside same transaction.</li>
<li>If the destination resource group does not have enough memory available to service the query&#x27;s current memory requirements, Apache Cloudberry returns the error: <code>group &lt;group_name&gt; doesn&#x27;t have enough memory ...</code>. In this situation, you might choose to increase the group shared memory allotted to the destination resource group, or perhaps wait a period of time for running queries to complete and then invoke the function again.</li>
</ul>
<p>After Apache Cloudberry moves the query, there is no way to guarantee that a query currently running in the destination resource group does not exceed the group memory limit. In this situation, one or more running queries in the destination group might fail, including the moved query. Reserve enough resource group global shared memory to minimize the potential for this scenario to occur.</p>
<p><code>pg_resgroup_move_query()</code> moves only the specified query to the destination resource group. Apache Cloudberry assigns subsequent queries that you submit in the session to the original resource group.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequently-asked-questions">Frequently asked questions<a href="#frequently-asked-questions" class="hash-link" aria-label="Direct link to Frequently asked questions" title="Direct link to Frequently asked questions">​</a></h2>
<p><strong>Why is CPU usage lower than the <code>CPU_MAX_PERCENT</code> configured for the resource group?</strong></p>
<p>You might run into this situation when a low number of queries and slices are running in the resource group, and these processes are not utilizing all of the cores on the system.</p>
<p>My resource group has a <code>CPU_WEIGHT</code> equivalent to 40%. Why is the CPU usage never reaching this limit?</p>
<p>The value of <code>CPU_MAX_PERCENT</code> might be lower than 40, hence it might be limiting the CPU usage even with idle resources.</p>
<p><strong>Why is the number of running transactions lower than the <code>CONCURRENCY</code> limit configured for the resource group?</strong></p>
<p>Apache Cloudberry considers memory availability before running a transaction, and will queue the transaction if there is not enough memory available to serve it. If you use <code>ALTER RESOURCE GROUP</code> to increase the <code>CONCURRENCY</code> limit for a resource group but do not also adjust memory limits, currently running transactions might be consuming all allotted memory resources for the group. When in this state, Apache Cloudberry queues subsequent transactions in the resource group.</p>
<p><strong>Why is the number of running transactions in the resource group higher than the configured <code>CONCURRENCY</code> limit?</strong></p>
<p>This behaviour is expected. There are several reasons why this might happen:</p>
<ul>
<li>Resource groups do not enforce resource restrictions on <code>SET</code>, <code>RESET</code> and <code>SHOW</code> commands.</li>
<li>The server configuration parameter <code>gp_resource_group_bypass</code> disables the concurrent transaction limit for the resource group so a query can run immediately.</li>
<li>If the server configuration parameter <code>gp_resource_group_bypass_catalog_query</code> is set to true (the default), all queries that read exclusively from system catalogs, or queries that contain in their query text <code>pg_catalog</code> schema tables only will not enforce the limits of the resource group.</li>
<li>Queries whose plan cost is less than the limit <code>MIN_COST</code> will be automatically unassigned from their resource group and will not enforce any of the limits set for this.</li>
</ul>
<p><strong>Why did my query return a “memory limit reached” error?</strong></p>
<p>Apache Cloudberry automatically adjusts transaction and group memory to the new settings when you use <code>ALTER RESOURCE GROUP</code> to change a resource group&#x27;s memory and/or concurrency limits. An “out of memory” error might occur if you recently altered resource group attributes and there is no longer a sufficient amount of memory available for a currently running query.</p>
<p><strong>My query cannot run due to insufficient memory, resulting in memory leak Out of Memory (OOM).</strong></p>
<p>First, ensure that the resource group is allocating enough memory required by the query by tuning resource group parameters such as <code>CONCURRENCY</code> and <code>MEMORY_LIMIT</code>. Analyze the type of query, whether there will be a lot of intermediate results using memory. If it does exist, you can set a reasonable <code>gp_resgroup_memory_query_fixed_mem</code> to allocate more memory at the session level for this specific query.</p>
<p><strong>After a memory leak OOM the system has a high concurrent load</strong>.</p>
<p>When the system starts to clean up the sessions left over by the memory leak, the concurrent load of the system is high at this time, and the OOM error message might reappear. Due to the current design, we cannot expedite the cleanup process of the Runaway Session. The solution to this problem is to adjust the <code>runaway_detector_activation_percent</code> to 0.85 or 0.8, or even lower, in order to increase the available memory of the segment host.</p>
<p><strong>Some transaction requests only run during a certain period of time, and do not run at other times.</strong></p>
<p>You might change the configuration of resource groups can be changed dynamically at regular intervals to match the requirements of your workload, and customize resource allocation at different times to achieve higher efficiency. For example, change the configuration of resources within a group, add or delete resource groups.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/docs/performance/manage-resources-using-resource-groups.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-01-20T07:12:08.000Z">Jan 20, 2025</time></b> by <b>zhangfei</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/performance/use-columnar-compression"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">Use Column-Level Compression</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/security/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">Security and Permission</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#role-and-component-resource-groups" class="table-of-contents__link toc-highlight">Role and component resource groups</a></li><li><a href="#resource-group-attributes-and-limits" class="table-of-contents__link toc-highlight">Resource group attributes and limits</a></li><li><a href="#configure-and-use-resource-groups" class="table-of-contents__link toc-highlight">Configure and use resource groups</a></li><li><a href="#enable-resource-groups" class="table-of-contents__link toc-highlight">Enable resource groups</a></li><li><a href="#create-resource-groups" class="table-of-contents__link toc-highlight">Create resource groups</a></li><li><a href="#configure-automatic-query-termination-based-on-memory-usage" class="table-of-contents__link toc-highlight">Configure automatic query termination based on memory usage</a></li><li><a href="#assign-a-resource-group-to-a-role" class="table-of-contents__link toc-highlight">Assign a resource group to a role</a></li><li><a href="#monitor-resource-group-status" class="table-of-contents__link toc-highlight">Monitor resource group status</a></li><li><a href="#move-a-query-to-a-different-resource-group" class="table-of-contents__link toc-highlight">Move a query to a different resource group</a></li><li><a href="#frequently-asked-questions" class="table-of-contents__link toc-highlight">Frequently asked questions</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/releases" target="_blank" rel="noopener noreferrer">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>