<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Apache Cloudberry (Incubating) | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/bootcamp/102-cbdb-crash-course"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Apache Cloudberry (Incubating) | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="Cloudberry Database ships with PostgreSQL 14.4 as the kernel. It is 100% open source and helps you leverage the value of your data."><meta data-rh="true" property="og:description" content="Cloudberry Database ships with PostgreSQL 14.4 as the kernel. It is 100% open source and helps you leverage the value of your data."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/bootcamp/102-cbdb-crash-course"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/bootcamp/102-cbdb-crash-course" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/zh/bootcamp/102-cbdb-crash-course" hreflang="zh"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/bootcamp/102-cbdb-crash-course" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.61dec7e1.css">
<script src="/assets/js/runtime~main.0799dbd8.js" defer="defer"></script>
<script src="/assets/js/main.e1aad5e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/contribute">Contribute</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/releases">Download</a><a class="navbar__item navbar__link" href="/support">Support</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/discussions/369" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/bootcamp">Bootcamp</a></li><li><a class="dropdown__link" href="/team">Team</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main><div class="wrap_RU01" style="background-image:url(/img/mdx-page/header-bg.png);background-size:cover"><div class="global-width-layout"><div class="breadcrumbs_JXRB mdxPage_GpzV" style="margin-top:15px"><a class="backLogoA_iDmL" href="/"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="backLogoSvg_u_DG"><path d="M15 15a.75.75 0 0 1-.75.75H3.75A.75.75 0 0 1 3 15V8.25H.75L8.495 1.21a.75.75 0 0 1 1.01 0L17.25 8.25H15V15ZM5.625 9.75a3.375 3.375 0 0 0 6.75 0h-1.5a1.875 1.875 0 0 1-3.75 0h-1.5Z" fill="#fff" opacity="0.3"></path></svg><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="backLogoLightSvg_VeXY"><path d="M15 15a.75.75 0 0 1-.75.75H3.75A.75.75 0 0 1 3 15V8.25H.75L8.495 1.21a.75.75 0 0 1 1.01 0L17.25 8.25H15V15ZM5.625 9.75a3.375 3.375 0 0 0 6.75 0h-1.5a1.875 1.875 0 0 1-3.75 0h-1.5Z" fill="#212121"></path></svg></a><div class="path_MxGL"><svg class="line_H094" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="m403.5 870.1 135.1-741.3h81.9L485.4 870.1z" fill="#606060"></path></svg><a class="backPath_eKch" href="/bootcamp">Bootcamp</a><svg class="line_H094" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="m403.5 870.1 135.1-741.3h81.9L485.4 870.1z" fill="#606060"></path></svg><span class="leafPath_R5jn">102-cbdb-crash-course</span></div></div><div class="content_pK97"><div class="main_qerj mdxCard_oyuC"><div class="content_Y_YK"><div class="bigText_Kz3d">[102] Apache Cloudberry Crash Course</div><div class="smallText_VASt">If you want to learn the Apache Cloudberry quickly, follow this crash course.</div></div></div></div></div></div><div class="mdxPageWrapper_yV3F"><div class="col col--8"><article><p>This crash course provides an extensive overview of Apache Cloudberry, an open-source Massively Parallel Processing (MPP) database. It covers key concepts, features, utilities, and hands-on exercises to become proficient with CBDB.</p>
<p>Topics include:</p>
<ul>
<li><a href="#lesson-0-prerequisite">Lesson 0. Prerequisite</a></li>
<li><a href="#lesson-1-where-to-read-the-official-documentation">Lesson 1. Where to read the official documentation</a></li>
<li><a href="#lesson-2-how-to-install-cbdb">Lesson 2. How to install CBDB</a></li>
<li><a href="#lesson-3-cluster-architecture">Lesson 3. Cluster architecture</a></li>
<li><a href="#lesson-4-management-utilities">Lesson 4. Management utilities</a></li>
<li><a href="#lesson-5-start-and-stop-a-cluster">Lesson 5. Start and stop a cluster</a></li>
<li><a href="#lesson-6-check-cluster-state">Lesson 6. Check cluster state</a></li>
<li><a href="#lesson-7-how-cbdb-segment-mirroring-works">Lesson 7. How CBDB segment mirroring works</a></li>
<li><a href="#lesson-8-cbdbs-fault-tolerance-and-segment-recovery">Lesson 8. CBDB&#x27;s fault tolerance and segment recovery</a></li>
<li><a href="#lesson-9-set-up-and-manage-the-standby-master-instance-in-cbdb">Lesson 9. Set up and manage the standby master instance in CBDB</a></li>
<li><a href="#lesson-10-expand-a-cluster">Lesson 10. Expand a cluster</a></li>
<li><a href="#lesson-11-check-cluster-performance">Lesson 11. Check cluster performance</a></li>
<li><a href="#lesson-12-user-data-and-table-distribution">Lesson 12. User data and table distribution</a></li>
<li><a href="#lesson-13-database-catalog">Lesson 13. Database catalog</a></li>
<li><a href="#lesson-14-cbdb-data-directories">Lesson 14. CBDB data directories</a></li>
<li><a href="#lesson-15-instance-processes">Lesson 15. Instance processes</a>
<ul>
<li><a href="#master-processes">master processes:</a></li>
<li><a href="#primary-processes">primary processes:</a></li>
<li><a href="#mirror-processes">mirror processes:</a></li>
</ul>
</li>
<li><a href="#lesson-16-database-log-files">Lesson 16. Database log files</a></li>
<li><a href="#lesson-17-table-types-in-cbdb-heap-ao-and-aoco">Lesson 17. Table types in CBDB: heap, AO, and AOCO</a></li>
<li><a href="#lesson-18-external-tables">Lesson 18. External tables</a></li>
<li><a href="#lesson-19-workload-management">Lesson 19. Workload management</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-0-prerequisite">Lesson 0. Prerequisite<a href="#lesson-0-prerequisite" class="hash-link" aria-label="Direct link to Lesson 0. Prerequisite" title="Direct link to Lesson 0. Prerequisite">​</a></h2>
<p>Before starting this crash course, spend some time going through the <a href="/bootcamp/#1-cloudberry-sandbox">Apache Cloudberry Tutorials Based on Single-Node Installation</a> to get familiar with Apache Cloudberry and how it works.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-1-where-to-read-the-official-documentation">Lesson 1. Where to read the official documentation<a href="#lesson-1-where-to-read-the-official-documentation" class="hash-link" aria-label="Direct link to Lesson 1. Where to read the official documentation" title="Direct link to Lesson 1. Where to read the official documentation">​</a></h2>
<p>Take a quick look at the official <a href="https://cloudberry.apache.org/docs" target="_blank" rel="noopener noreferrer">Cloudberry Documentation</a>. No need to worry if you do not understand everything.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-2-how-to-install-cbdb">Lesson 2. How to install CBDB<a href="#lesson-2-how-to-install-cbdb" class="hash-link" aria-label="Direct link to Lesson 2. How to install CBDB" title="Direct link to Lesson 2. How to install CBDB">​</a></h2>
<p>To begin your journey with CBDB, you are expected to install CBDB in your preferred environment. The following options are available:</p>
<ul>
<li>For testing or trying out CBDB in a sandbox environment, see <a href="/bootcamp/cbdb-sandbox">Install Cloudberry in a Sandbox</a>.</li>
<li>For deploying CBDB in other environments (including the production environment) and the prerequisite software/hardware configuration, see <a href="https://cloudberry.apache.org/docs/cbdb-op-deploy-guide" target="_blank" rel="noopener noreferrer">Cloudberry Deployment Guide</a>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-3-cluster-architecture">Lesson 3. Cluster architecture<a href="#lesson-3-cluster-architecture" class="hash-link" aria-label="Direct link to Lesson 3. Cluster architecture" title="Direct link to Lesson 3. Cluster architecture">​</a></h2>
<p>A CBDB cluster has one master host (usually named <code>mdw</code>) and multiple segment hosts (usually named <code>sdwXX</code>).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If someone is referring to <code>mdw</code>, he is referring to the &quot;master host&quot;. Similarly, when somebody is referring to &quot;sdw10&quot;, he is referring to the 10th segment host.</p></div></div>
<p>A master host usually contains only one instance - the master instance. The segment hosts might contain many worker instances. Every instance has its own set of processes, data directory, and listening port. For example, usually, the listening port of the master instance (where all clients will connect to) is <code>5432</code>.</p>
<p>Every segment instance has its own listening port, and the base port is specified in the cluster configuration file.</p>
<p>Instances can have 2 roles - primary and mirror. Primary instances serve database queries. Mirror instances simply track and record data changes in primary instances, but do not serve database queries. If the primary instance goes down for some reason, then the corresponding mirror instance transitions to the primary role and starts serving queries (the original primary instance, currently down, is marked as mirror).</p>
<p>The cluster information is stored in the <code>gp_segment_configuration</code> system table, which looks like this (use the &quot;psql&quot; command to connect to the database to execute queries):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ psql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">psql (14.4, server 14.4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Type &quot;help&quot; for help.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin</span><span class="token operator">=</span><span class="token comment" style="color:rgb(98, 114, 164)"># SELECT * FROM gp_segment_configuration;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> dbid </span><span class="token operator">|</span><span class="token plain"> content </span><span class="token operator">|</span><span class="token plain"> role </span><span class="token operator">|</span><span class="token plain"> preferred_role </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> port  </span><span class="token operator">|</span><span class="token plain"> hostname </span><span class="token operator">|</span><span class="token plain"> address </span><span class="token operator">|</span><span class="token plain">            datadir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">------+---------+------+----------------+------+--------+-------+----------+---------+--------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      </span><span class="token operator">-</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> p    </span><span class="token operator">|</span><span class="token plain"> p              </span><span class="token operator">|</span><span class="token plain"> n    </span><span class="token operator">|</span><span class="token plain"> u      </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">5432</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> mdw      </span><span class="token operator">|</span><span class="token plain"> mdw     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">data0</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">database</span><span class="token operator">/</span><span class="token plain">master</span><span class="token operator">/</span><span class="token plain">gpseg</span><span class="token operator">-</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> p    </span><span class="token operator">|</span><span class="token plain"> p              </span><span class="token operator">|</span><span class="token plain"> n    </span><span class="token operator">|</span><span class="token plain"> u      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">40000</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> mdw      </span><span class="token operator">|</span><span class="token plain"> mdw     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">data0</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">database</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">primary</span><span class="token operator">/</span><span class="token plain">gpseg0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> p    </span><span class="token operator">|</span><span class="token plain"> p              </span><span class="token operator">|</span><span class="token plain"> n    </span><span class="token operator">|</span><span class="token plain"> u      </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">40001</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> mdw      </span><span class="token operator">|</span><span class="token plain"> mdw     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">data0</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">database</span><span class="token operator">/</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">primary</span><span class="token operator">/</span><span class="token plain">gpseg1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The columns of this system are described as follows.</p>
<ul>
<li><code>dbid</code>: uniquely identifies a segment.</li>
<li><code>content</code>: uniquely identifies segment pairs (primary and mirror). The primary and the corresponding mirror will have the same <code>content</code> ID, but different <code>dbid</code> values. The master has the <code>content</code> value of <code>-1</code>. The worker instances have incremental content values of <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>...</li>
<li><code>role</code>: the current role of the segment.</li>
<li><code>preferred_role</code>: the role of the segment in the original configuration. Note that if an original mirror instance has taken over and become primary now, the role will be changed. This column records the original role.</li>
<li><code>mode</code>: the mode of the segment. The value options are <code>s</code> (in sync), <code>c</code> (in change tracking), and <code>r</code> (in recovery).</li>
<li><code>status</code>: the status of the segment. The value options are <code>u</code> (up) and <code>d</code> (down).</li>
<li><code>port</code>: the listening port of the segment. For clients, only the listening port of the master is important. The segment listening ports are important for the master to communicate with them.</li>
<li><code>hostname</code>: the hostname of the segment.</li>
<li><code>address</code>: each host can have different network controllers with different IP addresses and different names associated.</li>
<li><code>datadir</code>: the data directory where data is stored for each segment.</li>
</ul>
<p><strong>Exercise</strong></p>
<p>Connect to the CBDB cluster that you have created and take a look at the <code>gp_segment_configuration</code> table. Try to learn the rows and columns. Take a look at the cluster configuration file that you used to create the cluster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-4-management-utilities">Lesson 4. Management utilities<a href="#lesson-4-management-utilities" class="hash-link" aria-label="Direct link to Lesson 4. Management utilities" title="Direct link to Lesson 4. Management utilities">​</a></h2>
<p>Management utilities in CBDB are command-line tools used to administer and manage the database cluster. Some key points:</p>
<ul>
<li>They allow performing tasks like starting, stopping, and configuring the database.</li>
<li>Help monitor the health and status of the cluster.</li>
<li>Used for maintenance like recovering nodes and rebalancing data.</li>
<li>Help scale out the cluster by expanding with more nodes.</li>
<li>Utilities work across master, standby master, and multiple segment instances.</li>
</ul>
<p>In summary, management utilities are command-line programs and scripts used by DBAs to administer, monitor, maintain and manage a CBDB cluster. The following are some common utilities.</p>
<ul>
<li><code>gpstop</code>: stops database cluster.</li>
<li><code>gpstart</code>: starts database cluster.</li>
<li><code>psql</code>: a command-line client.</li>
<li><code>gpconfig</code>: shows or changes configuration parameters.</li>
<li><code>gpdeletesystem</code>: deletes a cluster.</li>
<li><code>pg_dump</code>, <code>gpbackup</code>, <code>gprestore</code>: performs backup and restore operations.</li>
<li><code>gpinitstanby</code>, <code>gpactivatestandby</code>: manages the standby master instance.</li>
<li><code>gprecoverseg</code>: recovers segment.</li>
<li><code>gpfdist</code>, <code>gpload</code>: operates with external tables.</li>
<li><code>gpssh</code>, <code>gpscp</code>, <code>gpssh-exkeys</code>: for cluster navigation.</li>
<li>Logging - all utilities write log files under <code>~/gpAdminLogs/</code> - one file per day</li>
</ul>
<p><strong>Exercise</strong></p>
<p>Read the help information for these tools (<code>&lt;tool_name&gt; --help</code>).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-5-start-and-stop-a-cluster">Lesson 5. Start and stop a cluster<a href="#lesson-5-start-and-stop-a-cluster" class="hash-link" aria-label="Direct link to Lesson 5. Start and stop a cluster" title="Direct link to Lesson 5. Start and stop a cluster">​</a></h2>
<ul>
<li>
<p>Start a CBDB cluster using <code>gpstart</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ gpstart -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Starting gpstart with args: -a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Gathering information and validating the environment...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Cloudberry Binary Version: &#x27;postgres (Apache Cloudberry) 1.0.0 build dev&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Cloudberry Catalog Version: &#x27;302206171&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Starting Coordinator instance in admin mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-CoordinatorStart pg_ctl cmd is env GPSESSID=0000000000 GPERA=None $GPHOME/bin/pg_ctl -D /data0/database/master/gpseg-1 -l /data0/database/master/gpseg-1/log/startup.log -w -t 600 -o &quot; -p 5432 -c gp_role=utility &quot; start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Obtaining Cloudberry Coordinator catalog information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Obtaining Segment details from coordinator...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Setting new coordinator era</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Coordinator Started...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Shutting down coordinator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:23:004256 gpstart:mdw:gpadmin-[INFO]:-Commencing parallel primary and mirror segment instance startup, please wait...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Process results...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-   Successful segment starts                                            = 4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-   Failed segment starts                                                = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-   Skipped segment starts (segments are marked down in configuration)   = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Successfully started 4 of 4 segment instances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Starting Coordinator instance mdw directory /data0/database/master/gpseg-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-CoordinatorStart pg_ctl cmd is env GPSESSID=0000000000 GPERA=45b5ca734de32094_230823161423 $GPHOME/bin/pg_ctl -D /data0/database/master/gpseg-1 -l /data0/database/master/gpseg-1/log/startup.log -w -t 600 -o &quot; -p 5432 -c gp_role=dispatch &quot; start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Command pg_ctl reports Coordinator mdw instance active</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Connecting to db template1 on host localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-No standby coordinator configured.  skipping...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:24:004256 gpstart:mdw:gpadmin-[INFO]:-Database successfully started</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Stop a CBDB cluster using <code>gpstop</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ gpstop -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Starting gpstop with args: -a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Gathering information and validating the environment...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Obtaining Cloudberry Coordinator catalog information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Obtaining Segment details from coordinator...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Cloudberry Version: &#x27;postgres (Apache Cloudberry) 1.0.0 build dev&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Commencing Coordinator instance shutdown with mode=&#x27;smart&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Coordinator segment instance directory=/data0/database/master/gpseg-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:18:004143 gpstop:mdw:gpadmin-[INFO]:-Stopping coordinator segment and waiting for user connections to finish ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server shutting down</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-Attempting forceful termination of any leftover coordinator process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-Terminating processes for segment /data0/database/master/gpseg-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-No standby coordinator host configured</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-Targeting dbid [2, 4, 3, 5] for shutdown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-Commencing parallel primary segment instance shutdown, please wait...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-0.00% of jobs completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-100.00% of jobs completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-Commencing parallel mirror segment instance shutdown, please wait...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:19:004143 gpstop:mdw:gpadmin-[INFO]:-0.00% of jobs completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-100.00% of jobs completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-   Segments stopped successfully      = 4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-   Segments with errors during stop   = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-Successfully shutdown 4 of 4 segment instances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:14:20:004143 gpstop:mdw:gpadmin-[INFO]:-Database successfully shutdown with no errors reported</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p><strong>Exercise</strong></p>
<p>Read the log entries for <code>gpstop</code> and <code>gpstart</code>, and try to understand what they mean. Read and exercise the different options for <code>gpstart</code> and <code>gpstop</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-6-check-cluster-state">Lesson 6. Check cluster state<a href="#lesson-6-check-cluster-state" class="hash-link" aria-label="Direct link to Lesson 6. Check cluster state" title="Direct link to Lesson 6. Check cluster state">​</a></h2>
<ul>
<li>
<p>Check the state of a cluster using <code>gpstate</code>.</p>
<p><code>gpstate</code> is the utility that can give you information about the state of the cluster. You can add different options to see different aspects of the cluster state.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ gpstate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-Starting gpstate with args:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-local Cloudberry Version: &#x27;postgres (Apache Cloudberry) 1.0.0 build dev&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-coordinator Cloudberry Version: &#x27;PostgreSQL 14.4 (Apache Cloudberry 1.0.0 build dev) on aarch64-unknown-linux-gnu, compiled by gcc (GCC) 10.2.1 20210130 (Red Hat 10.2.1-11), 64-bit compiled on Aug  9 2023 14:45:43&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-Obtaining Segment details from coordinator...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-Gathering data from segments...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-Cloudberry instance status summary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Coordinator instance                                      = Active</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Coordinator standby                                       = No coordinator standby configured</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total segment instance count from metadata                = 4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Primary Segment Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total primary segments                                    = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total primary segment valid (at coordinator)              = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total primary segment failures (at coordinator)           = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files missing              = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files found                = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs missing               = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found                 = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files missing                   = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files found                     = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes missing                 = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes found                   = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Mirror Segment Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total mirror segments                                     = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total mirror segment valid (at coordinator)               = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total mirror segment failures (at coordinator)            = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files missing              = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files found                = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs missing               = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found                 = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files missing                   = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files found                     = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes missing                 = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes found                   = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number mirror segments acting as primary segments   = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-   Total number mirror segments acting as mirror segments    = 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:17:41:004530 gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Check the status of a cluster by querying the <code>gp_segment_configuration</code> system table. The <code>gp_segment_configuration</code> table displays the &quot;master instance&quot; information about the state of the cluster.</p>
</li>
</ul>
<p><strong>Exercise</strong></p>
<p>Check the cluster state and try to collect the information using <code>gpstate</code> or <code>gp_segment_configuration</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-7-how-cbdb-segment-mirroring-works">Lesson 7. How CBDB segment mirroring works<a href="#lesson-7-how-cbdb-segment-mirroring-works" class="hash-link" aria-label="Direct link to Lesson 7. How CBDB segment mirroring works" title="Direct link to Lesson 7. How CBDB segment mirroring works">​</a></h2>
<p><strong>CBDB mirroring overview:</strong></p>
<p>Each segment instance in a Apache Cloudberry has 2 possible roles: primary and mirror.</p>
<ul>
<li>Primary role: serves user queries.</li>
<li>Mirror role: tracks and records data changes from the primary using WAL replication but does not serve user queries.</li>
</ul>
<p>If the primary segment instance encounters an issue and goes down, its corresponding mirror segment takes over the primary role to ensure continuity in serving queries. The system will then mark the original, now non-functional, primary segment as a mirror.</p>
<p><strong>Segment modes</strong></p>
<p>A segment can exist in one of the following modes:</p>
<ul>
<li><code>s</code>: In sync.</li>
<li><code>c</code>: Change tracking.</li>
<li><code>r</code>: In recovery.</li>
</ul>
<p>The ideal state for both primary and mirror segments is to be up and in-sync (represented as <code>P:u/s</code> and <code>M:u/s</code>).</p>
<p><strong>Scenarios for CBDB mirroring</strong></p>
<ul>
<li>
<p>Scenario 1: When the mirror instance goes down, the following process occurs.</p>
<ol>
<li>The primary segment transitions from the in-sync mode to the change tracking mode (<code>P:u/c</code> and <code>M:d/s</code>).</li>
<li>All data changes are recorded and stored.</li>
<li>The DBA, upon noticing this, investigates and starts a recovery for the mirror instance using the <code>gprecoverseg</code> command.</li>
<li>Both the primary and mirror segments transition to the recovery mode (<code>P:u/r</code>, <code>M:u/r</code>).</li>
<li>Post recovery, both the primary and mirror segments revert to the in-sync mode (<code>P:u/s</code>, <code>M:u/s</code>).</li>
</ol>
<p>This scenario remains transparent to users because the primary segment is still functional. Therefore, queries continue to run without interruptions.</p>
</li>
<li>
<p>Scenario 2: When the primary instance goes down, the following process occurs.</p>
<ol>
<li>All active sessions on the primary instance are terminated.</li>
<li>The database system marks the primary instance as &quot;down&quot; and promotes the mirror instance to the primary role, enabling it to track changes (<code>M:d/s</code>, <code>P:u/c</code>).</li>
<li>The DBA, upon detecting this situation, investigates and starts recovering the mirror using the <code>gprecoverseg</code> command.</li>
<li>On starting the recovery, both primary and mirror segments transition to the recovery mode <code>(M:u/r</code>, <code>P:u/r</code>).</li>
<li>Once the recovery is completed, both segments switch to the in-sync mode (<code>M:u/s</code>, <code>P:u/s</code>).</li>
</ol>
<p>After this recovery, the roles of the instances have been changed (the original primary is now a mirror). To revert the segments to their original roles, you need to rebalance them. This can be done by either:</p>
<ul>
<li>Using the <code>gpstop</code> and <code>gpstart</code> commands.</li>
<li>Using the <code>gprecoverseg -r</code> command for rebalancing.</li>
</ul>
</li>
</ul>
<p><strong>Add mirrors to an existing cluster</strong></p>
<p>If your CBDB cluster was initially created without mirrors, you can use the <code>gpaddmirrors</code> utility to add mirrors to the existing cluster. See the following example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ gpaddmirrors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>The example output of gpaddmirrors</summary><div><div class="collapsibleContent_i85q"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Starting gpaddmirrors with args:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-local Cloudberry Version: &#x27;postgres (Apache Cloudberry) 1.0.0 build dev&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-coordinator Cloudberry Version: &#x27;PostgreSQL 14.4 (Apache Cloudberry 1.0.0 build dev) on aarch64-unknown-linux-gnu, compiled by gcc (GCC) 10.2.1 20210130 (Red Hat 10.2.1-11), 64-bit compiled on Aug  9 2023 14:45:43&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Obtaining Segment details from coordinator...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Successfully finished pg_controldata /data0/database/primary/gpseg0 for dbid 2:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stdout: pg_control version number:            13000700</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Catalog version number:               302206171</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database system identifier:           7270424369249924934</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database cluster state:               in production</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pg_control last modified:             Wed 23 Aug 2023 03:59:52 PM CST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint location:           0/50EBA18</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s REDO location:    0/50EB9E0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s REDO WAL file:    000000010000000000000001</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s TimeLineID:       1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s PrevTimeLineID:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s full_page_writes: on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextXID:          0:762</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextGxid:         1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextOID:          13266</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextRelfilenode:  12002</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextMultiXactId:  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextMultiOffset:  0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestXID:        752</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestXID&#x27;s DB:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestActiveXID:  761</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestMultiXid:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestMulti&#x27;s DB: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestCommitTsXid:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s newestCommitTsXid:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Time of latest checkpoint:            Wed 23 Aug 2023 03:59:52 PM CST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Fake LSN counter for unlogged rels:   0/3E8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Minimum recovery ending location:     0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Min recovery ending loc&#x27;s timeline:   0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Backup start location:                0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Backup end location:                  0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">End-of-backup record required:        no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wal_level setting:                    replica</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wal_log_hints setting:                off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_connections setting:              60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_worker_processes setting:         13</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_wal_senders setting:              10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_prepared_xacts setting:           250</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_locks_per_xact setting:           128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">track_commit_timestamp setting:       off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum data alignment:               8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database block size:                  32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Blocks per segment of large relation: 32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WAL block size:                       32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bytes per WAL segment:                67108864</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum length of identifiers:        64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum columns in an index:          32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum size of a TOAST chunk:        8140</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Size of a large-object chunk:         8192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Date/time type storage:               64-bit integers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Float8 argument passing:              by value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Data page checksum version:           1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mock authentication nonce:            94edd2a762753f7d12faff1737ffb338dec6e01a90eb3d509c6afc67e78bf58e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">File encryption method:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stderr:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Successfully finished pg_controldata /data0/database/primary/gpseg1 for dbid 3:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stdout: pg_control version number:            13000700</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Catalog version number:               302206171</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database system identifier:           7270424369087874885</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database cluster state:               in production</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pg_control last modified:             Wed 23 Aug 2023 03:59:52 PM CST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint location:           0/50EBA18</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s REDO location:    0/50EB9E0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s REDO WAL file:    000000010000000000000001</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s TimeLineID:       1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s PrevTimeLineID:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s full_page_writes: on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextXID:          0:762</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextGxid:         1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextOID:          13266</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextRelfilenode:  12002</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextMultiXactId:  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s NextMultiOffset:  0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestXID:        752</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestXID&#x27;s DB:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestActiveXID:  761</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestMultiXid:   1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestMulti&#x27;s DB: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s oldestCommitTsXid:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Latest checkpoint&#x27;s newestCommitTsXid:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Time of latest checkpoint:            Wed 23 Aug 2023 03:59:52 PM CST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Fake LSN counter for unlogged rels:   0/3E8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Minimum recovery ending location:     0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Min recovery ending loc&#x27;s timeline:   0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Backup start location:                0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Backup end location:                  0/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">End-of-backup record required:        no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wal_level setting:                    replica</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wal_log_hints setting:                off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_connections setting:              60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_worker_processes setting:         13</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_wal_senders setting:              10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_prepared_xacts setting:           250</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">max_locks_per_xact setting:           128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">track_commit_timestamp setting:       off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum data alignment:               8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Database block size:                  32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Blocks per segment of large relation: 32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WAL block size:                       32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bytes per WAL segment:                67108864</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum length of identifiers:        64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum columns in an index:          32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Maximum size of a TOAST chunk:        8140</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Size of a large-object chunk:         8192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Date/time type storage:               64-bit integers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Float8 argument passing:              by value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Data page checksum version:           1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mock authentication nonce:            baf9fb0b44c5cc558357b266024336445d958e35f8896fcd94b5ef2143ad052d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">File encryption method:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stderr:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:02:50:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Heap checksum setting consistent across cluster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter mirror segment data directory location 1 of 2 &gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/data0/database/mirror</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter mirror segment data directory location 2 of 2 &gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/data0/database/mirror</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Cloudberry Add Mirrors Parameters</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Cloudberry coordinator data directory    = /data0/database/master/gpseg-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Cloudberry coordinator port              = 5432</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Batch size                              = 16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Segment batch size                      = 64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Mirror 1 of 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance host        = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance address     = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance directory   = /data0/database/primary/gpseg0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance port        = 40000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance host         = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance address      = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance directory    = /data0/database/mirror/gpseg0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance port         = 41000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Mirror 2 of 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance host        = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance address     = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance directory   = /data0/database/primary/gpseg1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Primary instance port        = 40001</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance host         = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance address      = mdw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance directory    = /data0/database/mirror/gpseg1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-   Mirror instance port         = 41001</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:16:003517 gpaddmirrors:mdw:gpadmin-[INFO]:---------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Continue with add mirrors procedure Yy|Nn (default=N):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; y</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:30:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Starting to create new pg_hba.conf on primary segments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:31:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Successfully modified pg_hba.conf on primary segments to allow replication connections</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:31:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-2 segment(s) to add</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:31:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Setting up the required segments for recovery</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:31:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Running recovery for the required segments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mdw (dbid 4): pg_basebackup: base backup completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mdw (dbid 5): pg_basebackup: base backup completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:33:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Updating configuration with new mirrors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:33:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Starting mirrors</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:33:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-era is 45b5ca734de32094_230823155950</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:33:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Commencing parallel segment instance startup, please wait...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Process results...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-******************************************************************</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Mirror segments have been added; data synchronization is in progress.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Data synchronization will continue in the background.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-Use  gpstate -s  to check the resynchronization progress.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">20230823:16:03:34:003517 gpaddmirrors:mdw:gpadmin-[INFO]:-******************************************************************</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><br></div></div></details>
<p><strong>Exercise</strong></p>
<p>Add mirrors to your cluster. If your cluster already has mirrors, delete the cluster and recreate one without mirrors (removing mirror segments is not supported).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-8-cbdbs-fault-tolerance-and-segment-recovery">Lesson 8. CBDB&#x27;s fault tolerance and segment recovery<a href="#lesson-8-cbdbs-fault-tolerance-and-segment-recovery" class="hash-link" aria-label="Direct link to Lesson 8. CBDB&#x27;s fault tolerance and segment recovery" title="Direct link to Lesson 8. CBDB&#x27;s fault tolerance and segment recovery">​</a></h2>
<p><strong>CBDB&#x27;s fault tolerance system</strong></p>
<p>CBDB&#x27;s Fault Tolerant Service (FTS) continuously watches over the cluster to ensure uninterrupted work with active segments. If a segment goes down, the system makes adjustments to ensure a primary instance is always ready for every content. A situation where both the primary and mirror instances of a content fail is called a &quot;double fault,&quot; rendering the database unusable.</p>
<p><strong>Working principle of the FTS service</strong></p>
<p>The FTS service operates from the master node using the &quot;ftsprober&quot; process. This process periodically scans segments. If it identifies any changes compared to the last saved configuration, it makes the necessary adjustments. Details about these adjustments are stored in the master log file and the <code>gp_configuration_history</code> table, while the status of each instance is updated in the <code>gp_segment_configuration</code> table.</p>
<p>The following is a preview of the <code>gp_configuration_history</code> table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin</span><span class="token operator">=</span><span class="token comment" style="color:rgb(98, 114, 164)"># SELECT * FROM gp_configuration_history;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">time</span><span class="token plain">              </span><span class="token operator">|</span><span class="token plain"> dbid </span><span class="token operator">|</span><span class="token plain">                                      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">desc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-------------------------------+------+--------------------------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">33.917057</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> gpaddmirrors: segment config </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> resync: inserted mirror segment configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">33.917057</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> gpaddmirrors: segment config </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> resync: inserted mirror segment configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">52.784083</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> FTS: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">update</span><span class="token plain"> role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dbid </span><span class="token number">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> contentid </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">52.78515</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> FTS: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">update</span><span class="token plain"> role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dbid </span><span class="token number">4</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> contentid </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">52.794198</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> FTS: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">update</span><span class="token plain"> role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dbid </span><span class="token number">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> contentid </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain">:</span><span class="token number">03</span><span class="token plain">:</span><span class="token number">52.794214</span><span class="token operator">+</span><span class="token number">08</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">5</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> FTS: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">update</span><span class="token plain"> role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dbid </span><span class="token number">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> contentid </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">to</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">rows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Recover a downed segment</strong></p>
<p>If a segment is down, you can recover it using the <code>gprecoverseg</code> utility. This tool will read the <code>gp_segment_configuration</code> table, identify the downed segment, and try to recover it using its related primary segment. However, for this recovery to work, the primary segment must be active.</p>
<p><strong>Investigate segment failures</strong></p>
<ol>
<li>Check the <code>gp_segment_configuration</code> table to find the downed segments and their mirrors.</li>
<li>Read the master log file to determine when the failure occurred. Look for log entries that start with &quot;FTS:&quot;.</li>
<li>Read the <code>gp_configuration_history</code> table to see a list of logged events.</li>
<li>Check the primary and mirror log files to understand why the segment failed.</li>
<li>Once you know the cause of the failure, use <code>gprecoverseg</code> to restore the segments.</li>
<li>To keep an eye on the recovery, use the <code>gpstate -e</code> command.</li>
</ol>
<p><strong>Exercise</strong></p>
<ol>
<li>Find the processes related to one of your database instances and stop it.</li>
<li>Watch the <code>gp_segment_configuration</code> table for any changes.</li>
<li>Next, read the master log file and again check the <code>gp_segment_configuration</code> table.</li>
<li>To fix the failed segment, use the recovery tools.</li>
<li>Confirm in the <code>gp_segment_configuration</code> table that the segment has been recovered.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-9-set-up-and-manage-the-standby-master-instance-in-cbdb">Lesson 9. Set up and manage the standby master instance in CBDB<a href="#lesson-9-set-up-and-manage-the-standby-master-instance-in-cbdb" class="hash-link" aria-label="Direct link to Lesson 9. Set up and manage the standby master instance in CBDB" title="Direct link to Lesson 9. Set up and manage the standby master instance in CBDB">​</a></h2>
<p><strong>Understand the role of the standby master</strong></p>
<p>In the CBDB architecture, the master instance can be a single point of failure. To avoid this, it is recommended to set up and maintain a &quot;standby master&quot; instance. Typically, this standby instance is set up on a distinct server, referred to as the &quot;standby master server&quot; or &quot;smdw&quot;.</p>
<p><strong>Manage standby master</strong></p>
<ul>
<li>To create the standby master (from the master server), use <code>gpinitstandby -s smdw</code>.</li>
<li>If the standby master falls out-of-sync, you can resynchronize it using <code>gpinitstandby -n</code>.</li>
<li>To remove the standby master, use <code>gpinitstandby -r</code>.</li>
</ul>
<p>After setting up the standby instance, you can query the <code>gp_segment_configuration</code> table. In the table output, the new standby instance will be visible, which is identified by a <code>content</code> value of <code>-1</code> and a <code>role</code> value of <code>&#x27;m&#x27;</code>.</p>
<p><strong>Promote the standby master</strong></p>
<p>If the master server or master instance is unavailable, the standby master can step in to take its place. To promote the standby master to the role of the master, run the <code>gpactivatestandby</code> command from the standby server.</p>
<p>Upon running this command, the roles change: the standby master becomes the master, while the original master gets demoted to the role of the standby instance, although it remains offline. You can query the <code>gp_segment_configuration</code> table again to notice these changes.</p>
<p><strong>Exercise</strong></p>
<ol>
<li>Create the standby master.</li>
<li>Remove the standby master.</li>
<li>Create the standby master again.</li>
<li>Activate this standby master to make it the primary master.</li>
<li>Create another standby master on the original master server.</li>
<li>Activate this new standby master.</li>
</ol>
<p>Throughout these steps, keep an eye on the <code>gp_segment_configuration</code> table. This will help you understand the changes in roles and the state of each instance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-10-expand-a-cluster">Lesson 10. Expand a cluster<a href="#lesson-10-expand-a-cluster" class="hash-link" aria-label="Direct link to Lesson 10. Expand a cluster" title="Direct link to Lesson 10. Expand a cluster">​</a></h2>
<p>If you need to expand a cluster, you can use the <code>gpexpand</code> tool. You can add new hosts or more segments to the current hosts.</p>
<p><strong>Steps to expand a cluster</strong></p>
<ol>
<li>
<p>Run <code>gpexpand</code> and answer questions.</p>
<p>Run &quot;gpexpand&quot;. In this step, you will be guided to answer questions about what you want to do. After answering all the questions, it makes a &quot;configuration file&quot; and stops. You should look at this file to check whether it is doing what you want.</p>
</li>
<li>
<p>Run <code>gpexpand -i &lt;config_file&gt;</code> to create new instances for the cluster.</p>
<p>This step creates the new instances of the cluster. These new instances will show up in the <code>gp_segment_configuration</code> table. The cluster is now expanded, but the new instances do not have the data from users yet.</p>
<p><code>gpexpand</code> also makes a new area called the <code>gpexpand</code> schema. This area has a list of tables that need to be spread out in the next step.</p>
</li>
<li>
<p>Run <code>gpexpand</code> again to redistribute or spread out the data.</p>
<p>Here, the data, which was only in the old instances, is now spread out to the expanded cluster. You can do this step many times by setting a time limit with the <code>-d</code> option. When all data is spread out, <code>gpexpand</code> stops.</p>
</li>
<li>
<p>Finish up.</p>
<p>Now, the cluster is expanded and the data is spread out. The <code>gpexpand</code> schema is still there. You can look at it if you need to. It will not cause any problems.</p>
<p>But if you want to expand the cluster again, <code>gpexpand</code> will tell you to remove it using <code>gpexpand -c</code> before it can continue.</p>
</li>
</ol>
<p><strong>Exercise</strong></p>
<ol>
<li>Run <code>gpexpand</code> to add more segments to your current servers.</li>
<li>Run <code>gpexpand</code> again to add segments on new servers.</li>
<li>Look at the <code>gp_segment_configuration</code> table to see how it changes with each action.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-11-check-cluster-performance">Lesson 11. Check cluster performance<a href="#lesson-11-check-cluster-performance" class="hash-link" aria-label="Direct link to Lesson 11. Check cluster performance" title="Direct link to Lesson 11. Check cluster performance">​</a></h2>
<p>You can use the <code>gpcheckperf</code> utility to check performance on a set of hosts (cluster). This utility can be used to check the following:</p>
<ul>
<li>
<p>I/O performance per host (with the <code>-r -d</code> options)</p>
<blockquote>
<p>Note: gpcheckperf will use the <code>dd</code> command to perform read test and write test on each host.</p>
</blockquote>
</li>
<li>
<p>Network performance (with the <code>-r -n|N|M</code> options)</p>
<blockquote>
<p>Note: <code>-n</code> means sequential. <code>-N</code> means parallel with even number of hosts. <code>-M</code> means full matrix mode.</p>
</blockquote>
</li>
<li>
<p>Memory bandwidth test per host (with the <code>-r -s</code> options)</p>
<blockquote>
<p>Note: The utility uses the STREAM benchmark program to measure sustainable memory bandwidth (in MB/s).</p>
</blockquote>
</li>
</ul>
<p><strong>Exercise</strong></p>
<p>Run <code>gpcheckcat</code> with the various options and interpret the results.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-12-user-data-and-table-distribution">Lesson 12. User data and table distribution<a href="#lesson-12-user-data-and-table-distribution" class="hash-link" aria-label="Direct link to Lesson 12. User data and table distribution" title="Direct link to Lesson 12. User data and table distribution">​</a></h2>
<p>In CBDB, the master instance does not store user data. Segments store user data, and the data is not shared between segments.</p>
<p>All CBDB Database tables are distributed. When you create or alter a table, you optionally specify DISTRIBUTED BY (hash distribution), DISTRIBUTED RANDOMLY (random distribution), or DISTRIBUTED REPLICATED (fully distributed) to determine the table row distribution.</p>
<p>Consider the following points when deciding on a table distribution policy.</p>
<ul>
<li><em>Even Data Distribution</em> — For the best possible performance, all segments should contain equal portions of data. If the data is unbalanced or skewed, the segments with more data must work harder to perform their portion of the query processing. Choose a distribution key that is unique for each record, such as the primary key.</li>
<li><em>Local and Distributed Operations</em> — Local operations are faster than distributed operations. Query processing is fastest if the work associated with join, sort, or aggregation operations is done locally, at the segment level. Work done at the system level requires distributing tuples across the segments, which is less efficient. When tables share a common distribution key, the work of joining or sorting on their shared distribution key columns is done locally. With a random distribution policy, local join operations are not an option.</li>
<li><em>Even Query Processing</em> — For best performance, all segments should handle an equal share of the query workload. Query workload can be skewed if a table&#x27;s data distribution policy and the query predicates are not well matched. For example, suppose that a sales transactions table is distributed on the customer ID column (the distribution key). If a predicate in a query references a single customer ID, the query processing work is concentrated on just one segment.</li>
</ul>
<p>The replicated table distribution policy (DISTRIBUTED REPLICATED) should be used only for small tables. Replicating data to every segment is costly in both storage and maintenance, and prohibitive for large fact tables. The primary use cases for replicated tables are to:</p>
<ul>
<li>remove restrictions on operations that user-defined functions can perform on segments, and</li>
<li>improve query performance by making it unnecessary to broadcast frequently used tables to all segments.</li>
</ul>
<p>In the following example, we can see the vaule &quot;1&quot; for c1 column is alwasy located in the same segment (gp_segment_id=1) if the table is distributed by hash.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# create table t1 (c1 int) distributed by (c1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t1 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t1 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t1 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t1 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# select gp_segment_id, * from t1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> gp_segment_id | c1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">---------------+----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(4 rows)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the following example, we can see the vaule &quot;1&quot; for c1 column is randomly distributed on all segments (gp_segment_id=0 and gp_segment_id=1) if the table is distributed randomly.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# create table t2 (c1 int) distributed randomly;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t2 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t2 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t2 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# insert into t2 values (1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT 0 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin=# select gp_segment_id, * from t2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> gp_segment_id | c1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">---------------+----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             0 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             1 |  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(4 rows)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Exercise: Reproduce the above with your own table and observe the effects.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-13-database-catalog">Lesson 13. Database catalog<a href="#lesson-13-database-catalog" class="hash-link" aria-label="Direct link to Lesson 13. Database catalog" title="Direct link to Lesson 13. Database catalog">​</a></h2>
<p>System tables prefixed with <em>gp_</em> relate to the parallel features of CBDB Database. Tables prefixed with <em>pg_</em> are either standard PostgreSQL system catalog tables supported in CBDB Database, or are related to features CBDB that provides to enhance PostgreSQL for data warehousing workloads. Note that the global system catalog for CBDB Database resides on the coordinator instance.</p>
<p>Exercise: Run the following query to get a list of catalog table names.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">select tablename from pg_tables where schemaname=&#x27;pg_catalog&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-14-cbdb-data-directories">Lesson 14. CBDB data directories<a href="#lesson-14-cbdb-data-directories" class="hash-link" aria-label="Direct link to Lesson 14. CBDB data directories" title="Direct link to Lesson 14. CBDB data directories">​</a></h2>
<p>In the master instance, the data directory is located at <code>/data0/database/master/gpseg-1</code>.</p>
<p>The following are the contents in the data directory of the master instance and coordinator instance:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw gpseg-1]$ ls -tlr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 156</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin     3 Aug 23 15:59 PG_VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_twophase</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_tblspc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_serial</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_replslot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_notify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 4 gpadmin gpadmin  4096 Aug 23 15:59 pg_multixact</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_dynshmem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_cryptokeys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_commit_ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    88 Aug 23 15:59 postgresql.auto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin  1636 Aug 23 15:59 pg_ident.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_xact</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 3 gpadmin gpadmin  4096 Aug 23 15:59 pg_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_subtrans</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_distributedlog</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin 31760 Aug 23 15:59 postgresql.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    10 Aug 23 15:59 internal.auto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- 1 gpadmin gpadmin   860 Aug 23 15:59 gpssh.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 6 gpadmin gpadmin  4096 Aug 23 15:59 base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r-- 1 gpadmin gpadmin  4723 Aug 23 15:59 pg_hba.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    38 Aug 23 16:14 current_logfiles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin   112 Aug 23 16:14 postmaster.opts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:14 pg_stat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin   130 Aug 23 16:14 gpsegconfig_dump</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    88 Aug 23 16:14 postmaster.pid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:14 log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:14 global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 4 gpadmin gpadmin  4096 Aug 23 16:39 pg_logical</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:44 pg_stat_tmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the segment instances, the data directory is located at <code>/data0/database/primary/gpseg0</code> and <code>/data0/database/primary/gpseg1</code>. The following are the contents in the data directory of a segment instance:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw gpseg-1]$ cd /data0/database/primary/gpseg0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw gpseg0]$ ls -ltr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 180</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_twophase</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_tblspc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_serial</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_notify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 4 gpadmin gpadmin  4096 Aug 23 15:59 pg_multixact</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_dynshmem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_cryptokeys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_commit_ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin     3 Aug 23 15:59 PG_VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin  1636 Aug 23 15:59 pg_ident.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_xact</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_subtrans</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 15:59 pg_distributedlog</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin 31637 Aug 23 15:59 postgresql.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    10 Aug 23 15:59 internal.auto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin  4915 Aug 23 16:03 pg_hba.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 7 gpadmin gpadmin  4096 Aug 23 16:03 base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 3 gpadmin gpadmin  4096 Aug 23 16:03 pg_replslot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 3 gpadmin gpadmin  4096 Aug 23 16:03 pg_wal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin   120 Aug 23 16:03 postgresql.auto.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:14 log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    38 Aug 23 16:14 current_logfiles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin   112 Aug 23 16:14 postmaster.opts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin    89 Aug 23 16:14 postmaster.pid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:14 pg_stat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:29 global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 4 gpadmin gpadmin  4096 Aug 23 16:44 pg_logical</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin 32768 Aug 23 16:44 fts_probe_file.bak</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------ 2 gpadmin gpadmin  4096 Aug 23 16:44 pg_stat_tmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Exercise</strong></p>
<p>Explore the data directory and subdirectories. Take a look at the configuration files.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-15-instance-processes">Lesson 15. Instance processes<a href="#lesson-15-instance-processes" class="hash-link" aria-label="Direct link to Lesson 15. Instance processes" title="Direct link to Lesson 15. Instance processes">​</a></h2>
<ul>
<li>
<p>postgres process: the process with the data directory in its name (-D ...) - this process is the parent for all other database processes and it handles connections to this instance</p>
</li>
<li>
<p>logger process: writes log entries in the log file</p>
</li>
<li>
<p>stats collector process: statistics collector is a subsystem that supports collection and reporting of information about server activity. Presently, the collector can count accesses to tables and indexes in both disk-block and individual-row terms.</p>
</li>
<li>
<p>background writer process: writes &quot;dirty&quot; (new or modified) buffers to the on-disk datafiles.</p>
</li>
<li>
<p>sweeper process: related to workload management and prioritization</p>
</li>
<li>
<p>checkpoint process: performs checkpoints</p>
</li>
<li>
<p>walwriter process: periodically flushes the WAL buffer to disk</p>
</li>
<li>
<p>ftsprobe process: runs in the coordinator node, and periodically polls the segments to maintain the status of each segment.</p>
</li>
<li>
<p>walsender process: runs in primary segment, and sends the WALs to the mirror segment</p>
</li>
<li>
<p>walreceiver process:  runs in mirror segment, and receives WALs from primary segment</p>
</li>
<li>
<p>conXXX: user connection worker process</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="master-processes">master processes:<a href="#master-processes" class="hash-link" aria-label="Direct link to master processes:" title="Direct link to master processes:">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ ps aux|grep 5432</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4409  0.0  0.4 209960 39776 ?        Ss   16:14   0:00 /usr/local/cloudberry-db/bin/postgres -D /data0/database/master/gpseg-1 -p 5432 -c gp_role=dispatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4410  0.0  0.0  45544  5160 ?        Ss   16:14   0:00 postgres:  5432, master logger process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4412  0.0  0.1 210256  9484 ?        Ss   16:14   0:00 postgres:  5432, checkpointer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4413  0.0  0.0 210124  7440 ?        Ss   16:14   0:00 postgres:  5432, background writer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4414  0.0  0.1 210124 10304 ?        Ss   16:14   0:00 postgres:  5432, walwriter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4415  0.0  0.1 211544 12068 ?        Ss   16:14   0:00 postgres:  5432, autovacuum launcher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4416  0.0  0.0  45768  5672 ?        Ss   16:14   0:00 postgres:  5432, stats collector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4417  0.0  0.2 278596 22164 ?        Ssl  16:14   0:00 postgres:  5432, dtx recovery process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4418  0.0  0.2 278416 21624 ?        Ssl  16:14   0:00 postgres:  5432, ftsprobe process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4427  0.0  0.1 211492 11244 ?        Ss   16:14   0:00 postgres:  5432, logical replication launcher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4428  0.0  0.2 277792 17748 ?        Ssl  16:14   0:00 postgres:  5432, pg_cron launcher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4429  0.0  0.0 210124  5316 ?        Ss   16:14   0:00 postgres:  5432, sweeper process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4846  0.0  0.5 294692 48516 ?        Ssl  16:25   0:00 postgres:  5432, gpadmin gpadmin [local] con46 cmd172 idle</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="primary-processes">primary processes:<a href="#primary-processes" class="hash-link" aria-label="Direct link to primary processes:" title="Direct link to primary processes:">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ ps aux|grep 40000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4373  0.0  0.5 212912 41404 ?        Ss   16:14   0:00 /usr/local/cloudberry-db/bin/postgres -D /data0/database/primary/gpseg0 -p 40000 -c gp_role=execute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4377  0.0  0.0  45540  5272 ?        Ss   16:14   0:00 postgres: 40000, logger process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4390  0.0  0.1 213212  9328 ?        Ss   16:14   0:00 postgres: 40000, checkpointer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4391  0.0  0.0 213076  7856 ?        Ss   16:14   0:00 postgres: 40000, background writer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4392  0.0  0.1 213076 10428 ?        Ss   16:14   0:00 postgres: 40000, walwriter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4393  0.0  0.1 213784  9948 ?        Ss   16:14   0:00 postgres: 40000, autovacuum launcher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4394  0.0  0.0  45768  5816 ?        Ss   16:14   0:00 postgres: 40000, stats collector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4395  0.0  0.0 213624  7984 ?        Ss   16:14   0:00 postgres: 40000, logical replication launcher</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4396  0.0  0.0 212912  4480 ?        Ss   16:14   0:00 postgres: 40000, sweeper process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4400  0.0  0.1 214868 12432 ?        Ss   16:14   0:00 postgres: 40000, walsender gpadmin 172.17.0.2(37278) streaming 0/100F9088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mirror-processes">mirror processes:<a href="#mirror-processes" class="hash-link" aria-label="Direct link to mirror processes:" title="Direct link to mirror processes:">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw ~]$ ps aux|grep 41000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4375  0.0  0.5 212912 41196 ?        Ss   16:14   0:00 /usr/local/cloudberry-db/bin/postgres -D /data0/database/mirror/gpseg0 -p 41000 -c gp_role=execute</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4379  0.0  0.0  45540  5160 ?        Ss   16:14   0:00 postgres: 41000, logger process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4383  0.0  0.1 213344 10908 ?        Ss   16:14   0:00 postgres: 41000, startup recovering 000000010000000000000004</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4385  0.0  0.1 212912  8352 ?        Ss   16:14   0:00 postgres: 41000, checkpointer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4386  0.0  0.0 212912  6260 ?        Ss   16:14   0:00 postgres: 41000, background writer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpadmin   4387  0.1  0.1 213788  9740 ?        Ss   16:14   0:04 postgres: 41000, walreceiver streaming 0/100F9088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Exercise: Try to identify the processes for the instances in your cluster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-16-database-log-files">Lesson 16. Database log files<a href="#lesson-16-database-log-files" class="hash-link" aria-label="Direct link to Lesson 16. Database log files" title="Direct link to Lesson 16. Database log files">​</a></h2>
<p>Each instance has its own log files which are located in the <code>&lt;data_directory&gt;/log</code> directory.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw log]$ pwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/data0/database/primary/gpseg0/log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[gpadmin@mdw log]$ ls -ltr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin 8842 Aug 23 16:14 gpdb-2023-08-23_155951.csv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin  468 Aug 23 16:14 startup.log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw------- 1 gpadmin gpadmin 3269 Aug 23 16:17 gpdb-2023-08-23_161424.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The standard log file name is <code>gpdb_&lt;date&gt;-&lt;time&gt;.csv</code>.</p>
<p><strong>Exercise</strong></p>
<p>Look at the log file and do different things in the database (create table, run queries, etc.)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-17-table-types-in-cbdb-heap-ao-and-aoco">Lesson 17. Table types in CBDB: heap, AO, and AOCO<a href="#lesson-17-table-types-in-cbdb-heap-ao-and-aoco" class="hash-link" aria-label="Direct link to Lesson 17. Table types in CBDB: heap, AO, and AOCO" title="Direct link to Lesson 17. Table types in CBDB: heap, AO, and AOCO">​</a></h2>
<p><strong>Heap tables</strong></p>
<p>In CBDB, the standard table type is &quot;heap&quot;. These tables store rows on pages, and one data file can contain multiple pages. They support common SQL tasks such as <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, and <code>TRUNCATE</code>. Each row in a heap table has a header. However, these tables do not support compression.</p>
<p><strong>AO tables</strong></p>
<p>Unlike heap tables, AO tables do not have a row header but they do allow compression. This feature makes AO tables a good fit for big fact tables.</p>
<p><strong>AOCO (column-oriented) tables</strong></p>
<p>For tasks that focus on single columns, like average (<code>AVG</code>) or sum, using row-oriented storage is not the ideal option. Instead, column-oriented tables, which store data by its column, are more efficient. This is because when you query one column, it does not get slowed down by the size or count of other columns.</p>
<p>AOCO tables offer compression, and they compress even better than AO tables. This is due to the consistent type of data in one file, which means that all data in a single column is of the same kind.</p>
<p><strong>Exercise</strong></p>
<p>Make a heap table, an AO table, and an AOCO table. After creating them, use the <code>\d+ psql</code> command to view the results.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-18-external-tables">Lesson 18. External tables<a href="#lesson-18-external-tables" class="hash-link" aria-label="Direct link to Lesson 18. External tables" title="Direct link to Lesson 18. External tables">​</a></h2>
<p>CBDB supports external tables. These tables are set up in the database, but they link to data outside of the database. Here is where the data for these tables can come from:</p>
<ul>
<li>A file on your local filesystem.</li>
<li>A file on a remote host (you need to use the <code>gpfdist</code> server for this).</li>
<li>HDFS, which stands for the <code>gphdfs</code> type.</li>
<li>Data generated on the spot with a command.</li>
</ul>
<p>One good thing about external tables is that they make it easy to load data into CBDB. When you use a command like <code>INSERT INTO table SELECT * FROM ext_table</code>, data gets loaded all at once from different parts, instead of one piece at a time.</p>
<p><strong>Exercise</strong></p>
<p>Try making different types of external tables and play around with them to learn more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-19-workload-management">Lesson 19. Workload management<a href="#lesson-19-workload-management" class="hash-link" aria-label="Direct link to Lesson 19. Workload management" title="Direct link to Lesson 19. Workload management">​</a></h2>
<p>In CBDB, we have something called Resource Queues, or RQ for short. Think of an RQ as a group of sessions that need similar things and share resources. You can put any user into an RQ.</p>
<p>Also, there is a feature called Priority. You can set a priority level for a whole RQ, which means every session in that RQ will have that priority. But if you want, you can set a priority for just one session using the <code>gp_adjust_priority()</code> function.</p>
<p><strong>Exercise</strong></p>
<p>Make a user, set up an RQ, put the user in the RQ, then run a query. Watch and see what happens to the RQ.</p></article></div><div class="col col--2 rightContent_xsg3" style="margin-left:50px"><div class="tableOfContents_jeP5 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lesson-0-prerequisite" class="table-of-contents__link toc-highlight">Lesson 0. Prerequisite</a></li><li><a href="#lesson-1-where-to-read-the-official-documentation" class="table-of-contents__link toc-highlight">Lesson 1. Where to read the official documentation</a></li><li><a href="#lesson-2-how-to-install-cbdb" class="table-of-contents__link toc-highlight">Lesson 2. How to install CBDB</a></li><li><a href="#lesson-3-cluster-architecture" class="table-of-contents__link toc-highlight">Lesson 3. Cluster architecture</a></li><li><a href="#lesson-4-management-utilities" class="table-of-contents__link toc-highlight">Lesson 4. Management utilities</a></li><li><a href="#lesson-5-start-and-stop-a-cluster" class="table-of-contents__link toc-highlight">Lesson 5. Start and stop a cluster</a></li><li><a href="#lesson-6-check-cluster-state" class="table-of-contents__link toc-highlight">Lesson 6. Check cluster state</a></li><li><a href="#lesson-7-how-cbdb-segment-mirroring-works" class="table-of-contents__link toc-highlight">Lesson 7. How CBDB segment mirroring works</a></li><li><a href="#lesson-8-cbdbs-fault-tolerance-and-segment-recovery" class="table-of-contents__link toc-highlight">Lesson 8. CBDB&#39;s fault tolerance and segment recovery</a></li><li><a href="#lesson-9-set-up-and-manage-the-standby-master-instance-in-cbdb" class="table-of-contents__link toc-highlight">Lesson 9. Set up and manage the standby master instance in CBDB</a></li><li><a href="#lesson-10-expand-a-cluster" class="table-of-contents__link toc-highlight">Lesson 10. Expand a cluster</a></li><li><a href="#lesson-11-check-cluster-performance" class="table-of-contents__link toc-highlight">Lesson 11. Check cluster performance</a></li><li><a href="#lesson-12-user-data-and-table-distribution" class="table-of-contents__link toc-highlight">Lesson 12. User data and table distribution</a></li><li><a href="#lesson-13-database-catalog" class="table-of-contents__link toc-highlight">Lesson 13. Database catalog</a></li><li><a href="#lesson-14-cbdb-data-directories" class="table-of-contents__link toc-highlight">Lesson 14. CBDB data directories</a></li><li><a href="#lesson-15-instance-processes" class="table-of-contents__link toc-highlight">Lesson 15. Instance processes</a></li><li><a href="#lesson-16-database-log-files" class="table-of-contents__link toc-highlight">Lesson 16. Database log files</a></li><li><a href="#lesson-17-table-types-in-cbdb-heap-ao-and-aoco" class="table-of-contents__link toc-highlight">Lesson 17. Table types in CBDB: heap, AO, and AOCO</a></li><li><a href="#lesson-18-external-tables" class="table-of-contents__link toc-highlight">Lesson 18. External tables</a></li><li><a href="#lesson-19-workload-management" class="table-of-contents__link toc-highlight">Lesson 19. Workload management</a></li></ul></div></div></div></main></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/releases" target="_blank" rel="noopener noreferrer">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>