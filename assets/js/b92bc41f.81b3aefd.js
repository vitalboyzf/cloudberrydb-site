"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[7631],{61958:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var s=t(85893),i=t(11151);const r={title:"COPY"},a="COPY",o={id:"sql-stmts/copy",title:"COPY",description:"Copies data between a file and a table.",source:"@site/docs/sql-stmts/copy.md",sourceDirName:"sql-stmts",slug:"/sql-stmts/copy",permalink:"/docs/sql-stmts/copy",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/sql-stmts/copy.md",tags:[],version:"current",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1740637488,formattedLastUpdatedAt:"Feb 27, 2025",frontMatter:{title:"COPY"},sidebar:"docsbars",previous:{title:"COMMIT",permalink:"/docs/sql-stmts/commit"},next:{title:"CREATE ACCESS METHOD",permalink:"/docs/sql-stmts/create-access-method"}},d={},l=[{value:"Synopsis",id:"synopsis",level:2},{value:"Description",id:"description",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Notes",id:"notes",level:2},{value:"File formats",id:"file-formats",level:2},{value:"Examples",id:"examples",level:2},{value:"Compatibility",id:"compatibility",level:2},{value:"See also",id:"see-also",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"copy",children:"COPY"}),"\n",(0,s.jsx)(n.p,{children:"Copies data between a file and a table."}),"\n",(0,s.jsx)(n.h2,{id:"synopsis",children:"Synopsis"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY <table_name> [(<column_name> [, ...])] \n     FROM {'<filename>' | PROGRAM '<command>' | STDIN}\n\xa0\xa0\xa0\xa0\xa0[ [ WITH ] ( <option> [, ...] ) ]\n     [ ON SEGMENT ]\n\nCOPY { <table_name> [(<column_name> [, ...])] | (<query>)} \n     TO {'<filename>' | PROGRAM '<command>' | STDOUT}\n\xa0\xa0\xa0\xa0\xa0[ [ WITH ] ( <option> [, ...] ) ]\n     [ ON SEGMENT ]\n\n-- where option can be one of:\n\nFORMAT <format_name>\nOIDS [ <boolean> ]\nFREEZE [ <boolean> ]\nDELIMITER '<delimiter_character>'\nNULL '<null string>'\nHEADER [ <boolean> ]\nQUOTE '<quote_character>'\nESCAPE '<escape_character>'\nFORCE_QUOTE { ( <column_name> [, ...] ) | * }\nFORCE_NOT_NULL ( <column_name> [, ...] ) \nFORCE_NULL ( <column_name> [, ...] )\nENCODING '<encoding_name>'       \nFILL MISSING FIELDS\nLOG ERRORS [ SEGMENT REJECT LIMIT <count> [ ROWS | PERCENT ] ]\nIGNORE EXTERNAL PARTITIONS\n"})}),"\n",(0,s.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY"})," moves data between Cloudberry Database tables and standard file-system files. ",(0,s.jsx)(n.code,{children:"COPY TO"})," copies the contents of a table to a file (or multiple files based on the segment ID if copying ",(0,s.jsx)(n.code,{children:"ON SEGMENT"}),"), while ",(0,s.jsx)(n.code,{children:"COPY FROM"})," copies data from a file to a table (appending the data to whatever is in the table already). ",(0,s.jsx)(n.code,{children:"COPY TO"})," can also copy the results of a ",(0,s.jsx)(n.code,{children:"SELECT"})," query."]}),"\n",(0,s.jsxs)(n.p,{children:["If a list of columns is specified, ",(0,s.jsx)(n.code,{children:"COPY"})," will only copy the data in the specified columns to or from the file. If there are any columns in the table that are not in the column list, ",(0,s.jsx)(n.code,{children:"COPY FROM"})," will insert the default values for those columns."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY"})," with a file name instructs the Cloudberry Database coordinator host to directly read from or write to a file. The file must be accessible to the coordinator host and the name must be specified from the viewpoint of the coordinator host."]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"COPY"})," is used with the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause, the ",(0,s.jsx)(n.code,{children:"COPY TO"})," causes segments to create individual segment-oriented files, which remain on the segment hosts. The filename argument for ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," takes the string literal ",(0,s.jsx)(n.code,{children:"<SEGID>"})," (required) and uses either the absolute path or the ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," string literal. When the ",(0,s.jsx)(n.code,{children:"COPY"})," operation is run, the segment IDs and the paths of the segment data directories are substituted for the string literal values."]}),"\n",(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:"COPY TO"})," with a replicated table (",(0,s.jsx)(n.code,{children:"DISTRIBUTED REPLICATED"}),") as source creates a file with rows from a single segment so that the target file contains no duplicate rows. Using ",(0,s.jsx)(n.code,{children:"COPY TO"})," with the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause with a replicated table as source creates target files on segment hosts containing all table rows."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause allows you to copy table data to files on segment hosts for use in operations such as migrating data between clusters or performing a backup. Segment data created by the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause can be restored by tools such as ",(0,s.jsx)(n.code,{children:"gpfdist"}),", which is useful for high speed data loading."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Caution"})," Use of the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause is recommended for expert users only."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"PROGRAM"})," is specified, the server runs the given command and reads from the standard output of the program, or writes to the standard input of the program. The command must be specified from the viewpoint of the server, and be executable by the ",(0,s.jsx)(n.code,{children:"gpadmin"})," user."]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"STDIN"})," or ",(0,s.jsx)(n.code,{children:"STDOUT"})," is specified, data is transmitted via the connection between the client and the coordinator. ",(0,s.jsx)(n.code,{children:"STDIN"})," and ",(0,s.jsx)(n.code,{children:"STDOUT"})," cannot be used with the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause."]}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"SEGMENT REJECT LIMIT"})," is used, then a ",(0,s.jsx)(n.code,{children:"COPY FROM"})," operation will operate in single row error isolation mode. In this release, single row error isolation mode only applies to rows in the input file with format errors \u2014 for example, extra or missing attributes, attributes of a wrong data type, or invalid client encoding sequences. Constraint errors such as violation of a ",(0,s.jsx)(n.code,{children:"NOT NULL"}),", ",(0,s.jsx)(n.code,{children:"CHECK"}),", or ",(0,s.jsx)(n.code,{children:"UNIQUE"})," constraint will still be handled in 'all-or-nothing' input mode. The user can specify the number of error rows acceptable (on a per-segment basis), after which the entire ",(0,s.jsx)(n.code,{children:"COPY FROM"})," operation will be cancelled and no rows will be loaded. The count of error rows is per-segment, not per entire load operation. If the per-segment reject limit is not reached, then all rows not containing an error will be loaded and any error rows discarded. To keep error rows for further examination, specify the ",(0,s.jsx)(n.code,{children:"LOG ERRORS"})," clause to capture error log information. The error information and the row is stored internally in Cloudberry Database."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Outputs"})}),"\n",(0,s.jsxs)(n.p,{children:["On successful completion, a ",(0,s.jsx)(n.code,{children:"COPY"})," command returns a command tag of the form, where count is the number of rows copied:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY <count>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If running a ",(0,s.jsx)(n.code,{children:"COPY FROM"})," command in single row error isolation mode, the following notice message will be returned if any rows were not loaded due to format errors, where count is the number of rows rejected:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"NOTICE: Rejected <count> badly formatted rows.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"table_name"})})}),"\n",(0,s.jsx)(n.p,{children:"The name (optionally schema-qualified) of an existing table."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"column_name"})})}),"\n",(0,s.jsx)(n.p,{children:"An optional list of columns to be copied. If no column list is specified, all columns of the table will be copied."}),"\n",(0,s.jsxs)(n.p,{children:["When copying in text format, the default, a row of data in a column of type ",(0,s.jsx)(n.code,{children:"bytea"})," can be up to 256MB."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"query"})})}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.code,{children:"SELECT"})," or ",(0,s.jsx)(n.code,{children:"VALUES"})," command whose results are to be copied. Note that parentheses are required around the query."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"filename"})})}),"\n",(0,s.jsxs)(n.p,{children:["The path name of the input or output file. An input file name can be an absolute or relative path, but an output file name must be an absolute path. Windows users might need to use an ",(0,s.jsx)(n.code,{children:"E''"})," string and double any backslashes used in the path name."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"PROGRAM 'command'"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specify a command to run. In ",(0,s.jsx)(n.code,{children:"COPY FROM"}),", the input is read from standard output of the command, and in ",(0,s.jsx)(n.code,{children:"COPY TO"}),", the output is written to the standard input of the command. The command must be specified from the viewpoint of the Cloudberry Database coordinator host system, and must be executable by the Cloudberry Database administrator user (",(0,s.jsx)(n.code,{children:"gpadmin"}),")."]}),"\n",(0,s.jsx)(n.p,{children:"The command is invoked by a shell. When passing arguments to the shell, strip or escape any special characters that have a special meaning for the shell. For security reasons, it is best to use a fixed command string, or at least avoid passing any user input in the string."}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," is specified, the command must be executable on all Cloudberry Database primary segment hosts by the Cloudberry Database administrator user (",(0,s.jsx)(n.code,{children:"gpadmin"}),"). The command is run by each Cloudberry segment instance. The ",(0,s.jsx)(n.code,{children:"<SEGID>"})," is required in the command."]}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause for information about command syntax requirements and the data that is copied when the clause is specified."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"STDIN"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies that input comes from the client application. The ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause is not supported with ",(0,s.jsx)(n.code,{children:"STDIN"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"STDOUT"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies that output goes to the client application. The ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause is not supported with ",(0,s.jsx)(n.code,{children:"STDOUT"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"boolean"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies whether the selected option should be turned on or off. You can write ",(0,s.jsx)(n.code,{children:"TRUE"}),", ",(0,s.jsx)(n.code,{children:"ON"}),", or ",(0,s.jsx)(n.code,{children:"1"})," to enable the option, and ",(0,s.jsx)(n.code,{children:"FALSE"}),", ",(0,s.jsx)(n.code,{children:"OFF"}),", or ",(0,s.jsx)(n.code,{children:"0"})," to deactivate it. The boolean value can also be omitted, in which case ",(0,s.jsx)(n.code,{children:"TRUE"})," is assumed."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FORMAT"})})}),"\n",(0,s.jsxs)(n.p,{children:["Selects the data format to be read or written: ",(0,s.jsx)(n.code,{children:"text"}),", ",(0,s.jsx)(n.code,{children:"csv"})," (Comma Separated Values), or ",(0,s.jsx)(n.code,{children:"binary"}),". The default is ",(0,s.jsx)(n.code,{children:"text"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"OIDS"})})}),"\n",(0,s.jsx)(n.p,{children:"Specifies copying the OID for each row. (An error is raised if OIDS is specified for a table that does not have OIDs, or in the case of copying a query.)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FREEZE"})})}),"\n",(0,s.jsxs)(n.p,{children:["Requests copying the data with rows already frozen, just as they would be after running the ",(0,s.jsx)(n.code,{children:"VACUUM FREEZE"})," command. This is intended as a performance option for initial data loading. Rows will be frozen only if the table being loaded has been created or truncated in the current subtransaction, there are no cursors open, and there are no older snapshots held by this transaction."]}),"\n",(0,s.jsx)(n.p,{children:"Note that all other sessions will immediately be able to see the data once it has been successfully loaded. This violates the normal rules of MVCC visibility and users specifying this option should be aware of the potential problems this might cause."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"DELIMITER"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies the character that separates columns within each row (line) of the file. The default is a tab character in ",(0,s.jsx)(n.code,{children:"text"})," format, a comma in ",(0,s.jsx)(n.code,{children:"CSV"})," format. This must be a single one-byte character. This option is not allowed when using ",(0,s.jsx)(n.code,{children:"binary"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"NULL"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies the string that represents a null value. The default is ",(0,s.jsx)(n.code,{children:"\\N"})," (backslash-N) in ",(0,s.jsx)(n.code,{children:"text"})," format, and an unquoted empty string in ",(0,s.jsx)(n.code,{children:"CSV"})," format. You might prefer an empty string even in ",(0,s.jsx)(n.code,{children:"text"})," format for cases where you don't want to distinguish nulls from empty strings. This option is not allowed when using ",(0,s.jsx)(n.code,{children:"binary"})," format."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," When using ",(0,s.jsx)(n.code,{children:"COPY FROM"}),", any data item that matches this string will be stored as a null value, so you should make sure that you use the same string as you used with ",(0,s.jsx)(n.code,{children:"COPY TO"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"HEADER"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies that a file contains a header line with the names of each column in the file. On output, the first line contains the column names from the table, and on input, the first line is ignored. This option is allowed only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"QUOTE"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies the quoting character to be used when a data value is quoted. The default is double-quote. This must be a single one-byte character. This option is allowed only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ESCAPE"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies the character that should appear before a data character that matches the ",(0,s.jsx)(n.code,{children:"QUOTE"})," value. The default is the same as the ",(0,s.jsx)(n.code,{children:"QUOTE"})," value (so that the quoting character is doubled if it appears in the data). This must be a single one-byte character. This option is allowed only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FORCE_QUOTE"})})}),"\n",(0,s.jsxs)(n.p,{children:["Forces quoting to be used for all non-",(0,s.jsx)(n.code,{children:"NULL"})," values in each specified column. ",(0,s.jsx)(n.code,{children:"NULL"})," output is never quoted. If ",(0,s.jsx)(n.code,{children:"*"}),"is specified, non-",(0,s.jsx)(n.code,{children:"NULL"})," values will be quoted in all columns. This option is allowed only in ",(0,s.jsx)(n.code,{children:"COPY TO"}),", and only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FORCE_NOT_NULL"})})}),"\n",(0,s.jsxs)(n.p,{children:["Do not match the specified columns' values against the null string. In the default case where the null string is empty, this means that empty values will be read as zero-length strings rather than nulls, even when they are not quoted. This option is allowed only in ",(0,s.jsx)(n.code,{children:"COPY FROM"}),", and only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FORCE_NULL"})})}),"\n",(0,s.jsxs)(n.p,{children:["Match the specified columns' values against the null string, even if it has been quoted, and if a match is found set the value to ",(0,s.jsx)(n.code,{children:"NULL"}),". In the default case where the null string is empty, this converts a quoted empty string into ",(0,s.jsx)(n.code,{children:"NULL"}),". This option is allowed only in ",(0,s.jsx)(n.code,{children:"COPY FROM"}),", and only when using ",(0,s.jsx)(n.code,{children:"CSV"})," format."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ENCODING"})})}),"\n",(0,s.jsx)(n.p,{children:"Specifies that the file is encoded in the encoding_name. If this option is omitted, the current client encoding is used. See the Notes below for more details."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ON SEGMENT"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specify individual, segment data files on the segment hosts. Each file contains the table data that is managed by the primary segment instance. For example, when copying data to files from a table with a ",(0,s.jsx)(n.code,{children:"COPY TO...ON SEGMENT"})," command, the command creates a file on the segment host for each segment instance on the host. Each file contains the table data that is managed by the segment instance."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"COPY"})," command does not copy data from or to mirror segment instances and segment data files."]}),"\n",(0,s.jsxs)(n.p,{children:["The keywords ",(0,s.jsx)(n.code,{children:"STDIN"})," and ",(0,s.jsx)(n.code,{children:"STDOUT"})," are not supported with ",(0,s.jsx)(n.code,{children:"ON SEGMENT"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," and ",(0,s.jsx)(n.code,{children:"<SEGID>"})," string literals are used to specify an absolute path and file name with the following syntax:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY <table> [TO|FROM] '<SEG_DATA_DIR>/<gpdumpname><SEGID>_<suffix>' ON SEGMENT;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR\\>"})})}),"\n",(0,s.jsxs)(n.p,{children:["The string literal representing the absolute path of the segment instance data directory for ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," copying. The angle brackets (",(0,s.jsx)(n.code,{children:"<"})," and ",(0,s.jsx)(n.code,{children:">"}),") are part of the string literal used to specify the path. ",(0,s.jsx)(n.code,{children:"COPY"})," replaces the string literal with the segment path(s) when ",(0,s.jsx)(n.code,{children:"COPY"})," is run. An absolute path can be used in place of the ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," string literal."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"<SEGID\\>"})})}),"\n",(0,s.jsxs)(n.p,{children:["The string literal representing the content ID number of the segment instance to be copied when copying ",(0,s.jsx)(n.code,{children:"ON SEGMENT"}),". ",(0,s.jsx)(n.code,{children:"<SEGID>"})," is a required part of the file name when ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," is specified. The angle brackets are part of the string literal used to specify the file name."]}),"\n",(0,s.jsxs)(n.p,{children:["With ",(0,s.jsx)(n.code,{children:"COPY TO"}),", the string literal is replaced by the content ID of the segment instance when the ",(0,s.jsx)(n.code,{children:"COPY"})," command is run."]}),"\n",(0,s.jsxs)(n.p,{children:["With ",(0,s.jsx)(n.code,{children:"COPY FROM"}),", specify the segment instance content ID in the name of the file and place that file on the segment instance host. There must be a file for each primary segment instance on each host. When the ",(0,s.jsx)(n.code,{children:"COPY FROM"})," command is run, the data is copied from the file to the segment instance."]}),"\n",(0,s.jsxs)(n.p,{children:["When the ",(0,s.jsx)(n.code,{children:"PROGRAM command"})," clause is specified, the ",(0,s.jsx)(n.code,{children:"<SEGID>"})," string literal is required in the command, the ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," string literal is optional. See ",(0,s.jsx)(n.a,{href:"#examples",children:"Examples"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["For a ",(0,s.jsx)(n.code,{children:"COPY FROM...ON SEGMENT"})," command, the table distribution policy is checked when data is copied into the table. By default, an error is returned if a data row violates the table distribution policy. You can deactivate the distribution policy check with the server configuration parameter ",(0,s.jsx)(n.code,{children:"gp_enable_segment_copy_checking"}),". See ",(0,s.jsx)(n.a,{href:"#notes",children:"Notes"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"NEWLINE"})})}),"\n",(0,s.jsxs)(n.p,{children:["Specifies the newline used in your data files \u2014 ",(0,s.jsx)(n.code,{children:"LF"})," (Line feed, 0x0A), ",(0,s.jsx)(n.code,{children:"CR"})," (Carriage return, 0x0D), or ",(0,s.jsx)(n.code,{children:"CRLF"})," (Carriage return plus line feed, 0x0D 0x0A). If not specified, a Cloudberry Database segment will detect the newline type by looking at the first row of data it receives and using the first newline type encountered."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"CSV"})})}),"\n",(0,s.jsxs)(n.p,{children:["Selects Comma Separated Value (CSV) mode. See ",(0,s.jsx)(n.a,{href:"#section9",children:"CSV Format"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FILL MISSING FIELDS"})})}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"COPY FROM"})," more for both ",(0,s.jsx)(n.code,{children:"TEXT"})," and ",(0,s.jsx)(n.code,{children:"CSV"}),", specifying ",(0,s.jsx)(n.code,{children:"FILL MISSING FIELDS"})," will set missing trailing field values to ",(0,s.jsx)(n.code,{children:"NULL"})," (instead of reporting an error) when a row of data has missing data fields at the end of a line or row. Blank rows, fields with a ",(0,s.jsx)(n.code,{children:"NOT NULL"})," constraint, and trailing delimiters on a line will still report an error."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"LOG ERRORS"})})}),"\n",(0,s.jsxs)(n.p,{children:["This is an optional clause that can precede a ",(0,s.jsx)(n.code,{children:"SEGMENT REJECT LIMIT"})," clause to capture error log information about rows with formatting errors."]}),"\n",(0,s.jsxs)(n.p,{children:["Error log information is stored internally and is accessed with the Cloudberry Database built-in SQL function ",(0,s.jsx)(n.code,{children:"gp_read_error_log()"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"#notes",children:"Notes"})," for information about the error log information and built-in functions for viewing and managing error log information."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"SEGMENT REJECT LIMIT count [ROWS | PERCENT]"})})}),"\n",(0,s.jsxs)(n.p,{children:["Runs a ",(0,s.jsx)(n.code,{children:"COPY FROM"})," operation in single row error isolation mode. If the input rows have format errors they will be discarded provided that the reject limit count is not reached on any Cloudberry Database segment instance during the load operation. The reject limit count can be specified as number of rows (the default) or percentage of total rows (1-100). If ",(0,s.jsx)(n.code,{children:"PERCENT"})," is used, each segment starts calculating the bad row percentage only after the number of rows specified by the parameter ",(0,s.jsx)(n.code,{children:"gp_reject_percent_threshold"})," has been processed. The default for ",(0,s.jsx)(n.code,{children:"gp_reject_percent_threshold"})," is 300 rows. Constraint errors such as violation of a ",(0,s.jsx)(n.code,{children:"NOT NULL"}),", ",(0,s.jsx)(n.code,{children:"CHECK"}),", or ",(0,s.jsx)(n.code,{children:"UNIQUE"})," constraint will still be handled in 'all-or-nothing' input mode. If the limit is not reached, all good rows will be loaded and any error rows discarded."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," Cloudberry Database limits the initial number of rows that can contain formatting errors if the ",(0,s.jsx)(n.code,{children:"SEGMENT REJECT LIMIT"})," is not triggered first or is not specified. If the first 1000 rows are rejected, the ",(0,s.jsx)(n.code,{children:"COPY"})," operation is stopped and rolled back."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The limit for the number of initial rejected rows can be changed with the Cloudberry Database server configuration parameter ",(0,s.jsx)(n.code,{children:"gp_initial_bad_row_limit"}),". See Server Configuration Parameters for information about the parameter."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"IGNORE EXTERNAL PARTITIONS"})})}),"\n",(0,s.jsx)(n.p,{children:"When copying data from partitioned tables, data are not copied from leaf partitions that are external tables. A message is added to the log file when data are not copied."}),"\n",(0,s.jsx)(n.p,{children:"If this clause is not specified and Cloudberry Database attempts to copy data from a leaf partition that is an external table, an error is returned."}),"\n",(0,s.jsx)(n.p,{children:'See the next section "Notes" for information about specifying an SQL query to copy data from leaf partitions that are external tables.'}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY"})," can only be used with tables, not with external tables or views. However, you can write ",(0,s.jsx)(n.code,{children:"COPY (SELECT * FROM viewname) TO ..."})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY"})," only deals with the specific table named; it does not copy data to or from child tables. Thus for example ",(0,s.jsx)(n.code,{children:"COPY table TO"})," shows the same data as ",(0,s.jsx)(n.code,{children:"SELECT * FROM ONLY "}),"table``. But ",(0,s.jsx)(n.code,{children:"COPY (SELECT * FROM table) TO ..."})," can be used to dump all of the data in an inheritance hierarchy."]}),"\n",(0,s.jsxs)(n.p,{children:["Similarly, to copy data from a partitioned table with a leaf partition that is an external table, use an SQL query to select the data to copy. For example, if the table ",(0,s.jsx)(n.code,{children:"my_sales"})," contains a leaf partition that is an external table, this command ",(0,s.jsx)(n.code,{children:"COPY my_sales TO stdout"})," returns an error. This command sends the data to ",(0,s.jsx)(n.code,{children:"stdout"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY (SELECT * from my_sales ) TO stdout\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"BINARY"})," keyword causes all data to be stored/read as binary format rather than as text. It is somewhat faster than the normal text mode, but a binary-format file is less portable across machine architectures and Cloudberry Database versions. Also, you cannot run ",(0,s.jsx)(n.code,{children:"COPY FROM"})," in single row error isolation mode if the data is in binary format."]}),"\n",(0,s.jsxs)(n.p,{children:["You must have ",(0,s.jsx)(n.code,{children:"SELECT"})," privilege on the table whose values are read by ",(0,s.jsx)(n.code,{children:"COPY TO"}),", and ",(0,s.jsx)(n.code,{children:"INSERT"})," privilege on the table into which values are inserted by ",(0,s.jsx)(n.code,{children:"COPY FROM"}),". It is sufficient to have column privileges on the columns listed in the command."]}),"\n",(0,s.jsxs)(n.p,{children:["Files named in a ",(0,s.jsx)(n.code,{children:"COPY"})," command are read or written directly by the database server, not by the client application. Therefore, they must reside on or be accessible to the Cloudberry Database coordinator host machine, not the client. They must be accessible to and readable or writable by the Cloudberry Database system user (the user ID the server runs as), not the client. Only database superusers are permitted to name files with ",(0,s.jsx)(n.code,{children:"COPY"}),", because this allows reading or writing any file that the server has privileges to access."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY FROM"})," will invoke any triggers and check constraints on the destination table. However, it will not invoke rewrite rules. Note that in this release, violations of constraints are not evaluated for single row error isolation mode."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"COPY"})," input and output is affected by ",(0,s.jsx)(n.code,{children:"DateStyle"}),". To ensure portability to other Cloudberry Database installations that might use non-default ",(0,s.jsx)(n.code,{children:"DateStyle"})," settings, ",(0,s.jsx)(n.code,{children:"DateStyle"})," should be set to ISO before using ",(0,s.jsx)(n.code,{children:"COPY TO"}),". It is also a good idea to avoid dumping data with IntervalStyle set to ",(0,s.jsx)(n.code,{children:"sql_standard"}),", because negative interval values might be misinterpreted by a server that has a different setting for IntervalStyle."]}),"\n",(0,s.jsxs)(n.p,{children:["Input data is interpreted according to ",(0,s.jsx)(n.code,{children:"ENCODING"})," option or the current client encoding, and output data is encoded in ",(0,s.jsx)(n.code,{children:"ENCODING"})," or the current client encoding, even if the data does not pass through the client but is read from or written to a file directly by the server."]}),"\n",(0,s.jsxs)(n.p,{children:["When copying XML data from a file in text mode, the server configuration parameter xmloption affects the validation of the XML data that is copied. If the value is ",(0,s.jsx)(n.code,{children:"content"})," (the default), XML data is validated as an XML content fragment. If the parameter value is ",(0,s.jsx)(n.code,{children:"document"}),", XML data is validated as an XML document. If the XML data is not valid, ",(0,s.jsx)(n.code,{children:"COPY"})," returns an error."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, ",(0,s.jsx)(n.code,{children:"COPY"})," stops operation at the first error. This should not lead to problems in the event of a ",(0,s.jsx)(n.code,{children:"COPY TO"}),", but the target table will already have received earlier rows in a ",(0,s.jsx)(n.code,{children:"COPY FROM"}),". These rows will not be visible or accessible, but they still occupy disk space. This may amount to a considerable amount of wasted disk space if the failure happened well into a large ",(0,s.jsx)(n.code,{children:"COPY FROM"})," operation. You may wish to invoke ",(0,s.jsx)(n.code,{children:"VACUUM"})," to recover the wasted space. Another option would be to use single row error isolation mode to filter out error rows while still loading good rows."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"FORCE_NULL"})," and ",(0,s.jsx)(n.code,{children:"FORCE_NOT_NULL"})," can be used simultaneously on the same column. This results in converting quoted null strings to null values and unquoted null strings to empty strings."]}),"\n",(0,s.jsxs)(n.p,{children:["When a ",(0,s.jsx)(n.code,{children:"COPY FROM...ON SEGMENT"})," command is run, the server configuration parameter ",(0,s.jsx)(n.code,{children:"gp_enable_segment_copy_checking"})," controls whether the table distribution policy (from the table ",(0,s.jsx)(n.code,{children:"DISTRIBUTED"})," clause) is checked when data is copied into the table. The default is to check the distribution policy. An error is returned if the row of data violates the distribution policy for the segment instance. For information about the parameter, see Server Configuration Parameters."]}),"\n",(0,s.jsxs)(n.p,{children:["Data from a table that is generated by a ",(0,s.jsx)(n.code,{children:"COPY TO...ON SEGMENT"})," command can be used to restore table data with ",(0,s.jsx)(n.code,{children:"COPY FROM...ON SEGMENT"}),". However, data restored to the segments is distributed according to the table distribution policy at the time the files were generated with the ",(0,s.jsx)(n.code,{children:"COPY TO"})," command. The ",(0,s.jsx)(n.code,{children:"COPY"})," command might return table distribution policy errors, if you attempt to restore table data and the table distribution policy was changed after the ",(0,s.jsx)(n.code,{children:"COPY FROM...ON SEGMENT"})," was run."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," If you run ",(0,s.jsx)(n.code,{children:"COPY FROM...ON SEGMENT"})," and the server configuration parameter ",(0,s.jsx)(n.code,{children:"gp_enable_segment_copy_checking"})," is ",(0,s.jsx)(n.code,{children:"false"}),", manual redistribution of table data might be required. See the ",(0,s.jsx)(n.code,{children:"ALTER TABLE"})," clause ",(0,s.jsx)(n.code,{children:"WITH REORGANIZE"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When you specify the ",(0,s.jsx)(n.code,{children:"LOG ERRORS"})," clause, Cloudberry Database captures errors that occur while reading the external table data. You can view and manage the captured error log data."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Use the built-in SQL function ",(0,s.jsx)(n.code,{children:"gp_read_error_log('table_name')"}),". It requires ",(0,s.jsx)(n.code,{children:"SELECT"})," privilege on table_name. This example displays the error log information for data loaded into table ",(0,s.jsx)(n.code,{children:"ext_expenses"})," with a ",(0,s.jsx)(n.code,{children:"COPY"})," command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * from gp_read_error_log('ext_expenses');\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The function returns ",(0,s.jsx)(n.code,{children:"FALSE"})," if table_name does not exist."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If error log data exists for the specified table, the new error log data is appended to existing error log data. The error log information is not replicated to mirror segments."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Use the built-in SQL function ",(0,s.jsx)(n.code,{children:"gp_truncate_error_log('table_name')"})," to delete the error log data for table_name. It requires the table owner privilege This example deletes the error log information captured when moving data into the table ",(0,s.jsx)(n.code,{children:"ext_expenses"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT gp_truncate_error_log('ext_expenses'); \n"})}),"\n",(0,s.jsxs)(n.p,{children:["The function returns ",(0,s.jsx)(n.code,{children:"FALSE"})," if table_name does not exist."]}),"\n",(0,s.jsxs)(n.p,{children:["Specify the ",(0,s.jsx)(n.code,{children:"*"})," wildcard character to delete error log information for existing tables in the current database. Specify the string ",(0,s.jsx)(n.code,{children:"*.*"})," to delete all database error log information, including error log information that was not deleted due to previous database issues. If * is specified, database owner privilege is required. If ",(0,s.jsx)(n.code,{children:"*.*"})," is specified, operating system super-user privilege is required."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When a Cloudberry Database user who is not a superuser runs a ",(0,s.jsx)(n.code,{children:"COPY"})," command, the command can be controlled by a resource queue. The resource queue must be configured with the ",(0,s.jsx)(n.code,{children:"ACTIVE_STATEMENTS"})," parameter that specifies a maximum limit on the number of queries that can be run by roles assigned to that queue. Cloudberry Database does not apply a cost value or memory value to a ",(0,s.jsx)(n.code,{children:"COPY"})," command, resource queues with only cost or memory limits do not affect the running of ",(0,s.jsx)(n.code,{children:"COPY"})," commands."]}),"\n",(0,s.jsxs)(n.p,{children:["A non-superuser can run only these types of ",(0,s.jsx)(n.code,{children:"COPY"})," commands:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"COPY FROM"})," command where the source is ",(0,s.jsx)(n.code,{children:"stdin"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"COPY TO"})," command where the destination is ",(0,s.jsx)(n.code,{children:"stdout"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"file-formats",children:"File formats"}),"\n",(0,s.jsxs)(n.p,{children:["File formats supported by ",(0,s.jsx)(n.code,{children:"COPY"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Text Format"})}),"\n",(0,s.jsxs)(n.p,{children:["When the ",(0,s.jsx)(n.code,{children:"text"})," format is used, the data read or written is a text file with one line per table row. Columns in a row are separated by the delimiter_character (tab by default). The column values themselves are strings generated by the output function, or acceptable to the input function, of each attribute's data type. The specified null string is used in place of columns that are null. ",(0,s.jsx)(n.code,{children:"COPY FROM"})," will raise an error if any line of the input file contains more or fewer columns than are expected. If ",(0,s.jsx)(n.code,{children:"OIDS"})," is specified, the OID is read or written as the first column, preceding the user data columns."]}),"\n",(0,s.jsxs)(n.p,{children:["The data file has two reserved characters that have special meaning to ",(0,s.jsx)(n.code,{children:"COPY"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The designated delimiter character (tab by default), which is used to separate fields in the data file."}),"\n",(0,s.jsxs)(n.li,{children:["A UNIX-style line feed (",(0,s.jsx)(n.code,{children:"\\n"})," or ",(0,s.jsx)(n.code,{children:"0x0a"}),"), which is used to designate a new row in the data file. It is strongly recommended that applications generating ",(0,s.jsx)(n.code,{children:"COPY"})," data convert data line feeds to UNIX-style line feeds rather than Microsoft Windows style carriage return line feeds (",(0,s.jsx)(n.code,{children:"\\r\\n"})," or ",(0,s.jsx)(n.code,{children:"0x0a 0x0d"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If your data contains either of these characters, you must escape the character so ",(0,s.jsx)(n.code,{children:"COPY"})," treats it as data and not as a field separator or new row."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, the escape character is a \\ (backslash) for text-formatted files and a ",(0,s.jsx)(n.code,{children:'"'})," (double quote) for csv-formatted files. If you want to use a different escape character, you can do so using the ",(0,s.jsx)(n.code,{children:"ESCAPE AS"}),"clause. Make sure to choose an escape character that is not used anywhere in your data file as an actual data value. You can also deactivate escaping in text-formatted files by using ",(0,s.jsx)(n.code,{children:"ESCAPE 'OFF'"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, suppose you have a table with three columns and you want to load the following three fields using ",(0,s.jsx)(n.code,{children:"COPY"}),"."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"percentage sign = %"}),"\n",(0,s.jsx)(n.li,{children:"vertical bar = |"}),"\n",(0,s.jsx)(n.li,{children:"backslash = \\"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Your designated delimiter_character is ",(0,s.jsx)(n.code,{children:"|"})," (pipe character), and your designated escape character is ",(0,s.jsx)(n.code,{children:"*"})," (asterisk). The formatted row in your data file would look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"percentage sign = % | vertical bar = *| | backslash = \\\n"})}),"\n",(0,s.jsx)(n.p,{children:"Notice how the pipe character that is part of the data has been escaped using the asterisk character (*). Also notice that we do not need to escape the backslash since we are using an alternative escape character."}),"\n",(0,s.jsxs)(n.p,{children:["The following characters must be preceded by the escape character if they appear as part of a column value: the escape character itself, newline, carriage return, and the current delimiter character. You can specify a different escape character using the ",(0,s.jsx)(n.code,{children:"ESCAPE AS"})," clause."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CSV Format"})}),"\n",(0,s.jsx)(n.p,{children:"This format option is used for importing and exporting the Comma Separated Value (CSV) file format used by many other programs, such as spreadsheets. Instead of the escaping rules used by Cloudberry Database standard text format, it produces and recognizes the common CSV escaping mechanism."}),"\n",(0,s.jsxs)(n.p,{children:["The values in each record are separated by the ",(0,s.jsx)(n.code,{children:"DELIMITER"})," character. If the value contains the delimiter character, the ",(0,s.jsx)(n.code,{children:"QUOTE"})," character, the ",(0,s.jsx)(n.code,{children:"ESCAPE"})," character (which is double quote by default), the ",(0,s.jsx)(n.code,{children:"NULL"})," string, a carriage return, or line feed character, then the whole value is prefixed and suffixed by the ",(0,s.jsx)(n.code,{children:"QUOTE"})," character. You can also use ",(0,s.jsx)(n.code,{children:"FORCE_QUOTE"})," to force quotes when outputting non-",(0,s.jsx)(n.code,{children:"NULL"})," values in specific columns."]}),"\n",(0,s.jsxs)(n.p,{children:["The CSV format has no standard way to distinguish a ",(0,s.jsx)(n.code,{children:"NULL"})," value from an empty string. Cloudberry Database ",(0,s.jsx)(n.code,{children:"COPY"})," handles this by quoting. A ",(0,s.jsx)(n.code,{children:"NULL"})," is output as the ",(0,s.jsx)(n.code,{children:"NULL"})," parameter string and is not quoted, while a non-",(0,s.jsx)(n.code,{children:"NULL"})," value matching the ",(0,s.jsx)(n.code,{children:"NULL"})," string is quoted. For example, with the default settings, a ",(0,s.jsx)(n.code,{children:"NULL"})," is written as an unquoted empty string, while an empty string data value is written with double quotes (",(0,s.jsx)(n.code,{children:'""'}),"). Reading values follows similar rules. You can use ",(0,s.jsx)(n.code,{children:"FORCE_NOT_NULL"})," to prevent ",(0,s.jsx)(n.code,{children:"NULL"})," input comparisons for specific columns. You can also use ",(0,s.jsx)(n.code,{children:"FORCE_NULL"})," to convert quoted null string data values to ",(0,s.jsx)(n.code,{children:"NULL"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Because backslash is not a special character in the ",(0,s.jsx)(n.code,{children:"CSV"})," format, ",(0,s.jsx)(n.code,{children:"\\."}),", the end-of-data marker, could also appear as a data value. To avoid any misinterpretation, a ",(0,s.jsx)(n.code,{children:"\\."})," data value appearing as a lone entry on a line is automatically quoted on output, and on input, if quoted, is not interpreted as the end-of-data marker. If you are loading a file created by another application that has a single unquoted column and might have a value of ",(0,s.jsx)(n.code,{children:"\\."}),", you might need to quote that value in the input file."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," In ",(0,s.jsx)(n.code,{children:"CSV"})," format, all characters are significant. A quoted value surrounded by white space, or any characters other than ",(0,s.jsx)(n.code,{children:"DELIMITER"}),", will include those characters. This can cause errors if you import data from a system that pads CSV lines with white space out to some fixed width. If such a situation arises you might need to preprocess the CSV file to remove the trailing white space, before importing the data into Cloudberry Database."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CSV"})," format will both recognize and produce CSV files with quoted values containing embedded carriage returns and line feeds. Thus the files are not strictly one line per table row like text-format files"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," Many programs produce strange and occasionally perverse CSV files, so the file format is more a convention than a standard. Thus you might encounter some files that cannot be imported using this mechanism, and ",(0,s.jsx)(n.code,{children:"COPY"})," might produce files that other programs cannot process."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Binary Format"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"binary"})," format option causes all data to be stored/read as binary format rather than as text. It is somewhat faster than the text and ",(0,s.jsx)(n.code,{children:"CSV"})," formats, but a binary-format file is less portable across machine architectures and Cloudberry Database versions. Also, the binary format is very data type specific; for example it will not work to output binary data from a ",(0,s.jsx)(n.code,{children:"smallint"})," column and read it into an ",(0,s.jsx)(n.code,{children:"integer"})," column, even though that would work fine in text format."]}),"\n",(0,s.jsx)(n.p,{children:"The binary file format consists of a file header, zero or more tuples containing the row data, and a file trailer. Headers and data are in network byte order."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Header"})," \u2014 The file header consists of 15 bytes of fixed fields, followed by a variable-length header extension area. The fixed fields are:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Signature"})," \u2014 11-byte sequence PGCOPY\\n\\377\\r\\n\\0 \u2014 note that the zero byte is a required part of the signature. (The signature is designed to allow easy identification of files that have been munged by a non-8-bit-clean transfer. This signature will be changed by end-of-line-translation filters, dropped zero bytes, dropped high bits, or parity changes.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Flags field"})," \u2014 32-bit integer bit mask to denote important aspects of the file format. Bits are numbered from 0 (LSB) to 31 (MSB). Note that this field is stored in network byte order (most significant byte first), as are all the integer fields used in the file format. Bits 16-31 are reserved to denote critical file format issues; a reader should cancel if it finds an unexpected bit set in this range. Bits 0-15 are reserved to signal backwards-compatible format issues; a reader should simply ignore any unexpected bits set in this range. Currently only one flag is defined, and the rest must be zero (Bit 16: 1 if data has OIDs, 0 if not)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Header extension area length"})," \u2014 32-bit integer, length in bytes of remainder of header, not including self. Currently, this is zero, and the first tuple follows immediately. Future changes to the format might allow additional data to be present in the header. A reader should silently skip over any header extension data it does not know what to do with. The header extension area is envisioned to contain a sequence of self-identifying chunks. The flags field is not intended to tell readers what is in the extension area. Specific design of header extension contents is left for a later release."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Tuples"})," \u2014 Each tuple begins with a 16-bit integer count of the number of fields in the tuple. (Presently, all tuples in a table will have the same count, but that might not always be true.) Then, repeated for each field in the tuple, there is a 32-bit length word followed by that many bytes of field data. (The length word does not include itself, and can be zero.) As a special case, -1 indicates a NULL field value. No value bytes follow in the NULL case."]}),"\n",(0,s.jsx)(n.p,{children:"There is no alignment padding or any other extra data between fields."}),"\n",(0,s.jsx)(n.p,{children:"Presently, all data values in a binary-format file are assumed to be in binary format (format code one). It is anticipated that a future extension may add a header field that allows per-column format codes to be specified."}),"\n",(0,s.jsx)(n.p,{children:"If OIDs are included in the file, the OID field immediately follows the field-count word. It is a normal field except that it is not included in the field-count. In particular it has a length word \u2014 this will allow handling of 4-byte vs. 8-byte OIDs without too much pain, and will allow OIDs to be shown as null if that ever proves desirable."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Trailer"})," \u2014 The file trailer consists of a 16-bit integer word containing ",(0,s.jsx)(n.code,{children:"-1"}),". This is easily distinguished from a tuple's field-count word. A reader should report an error if a field-count word is neither ",(0,s.jsx)(n.code,{children:"-1"})," nor the expected number of columns. This provides an extra check against somehow getting out of sync with the data."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.p,{children:"Copy a table to the client using the vertical bar (|) as the field delimiter:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY country TO STDOUT (DELIMITER '|');\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Copy data from a file into the ",(0,s.jsx)(n.code,{children:"country"})," table:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY country FROM '/home/usr1/sql/country_data';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Copy into a file just the countries whose names start with 'A':"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY (SELECT * FROM country WHERE country_name LIKE 'A%') TO \n'/home/usr1/sql/a_list_countries.copy';\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Copy data from a file into the ",(0,s.jsx)(n.code,{children:"sales"})," table using single row error isolation mode and log errors:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY sales FROM '/home/usr1/sql/sales_data' LOG ERRORS \n   SEGMENT REJECT LIMIT 10 ROWS;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To copy segment data for later use, use the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clause. Use of the ",(0,s.jsx)(n.code,{children:"COPY TO ON SEGMENT"})," command takes the form:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY <table> TO '<SEG_DATA_DIR>/<gpdumpname><SEGID>_<suffix>' ON SEGMENT; \n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"<SEGID>"})," is required. However, you can substitute an absolute path for the ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," string literal in the path."]}),"\n",(0,s.jsxs)(n.p,{children:["When you pass in the string literal ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"})," and ",(0,s.jsx)(n.code,{children:"<SEGID>"})," to ",(0,s.jsx)(n.code,{children:"COPY"}),", ",(0,s.jsx)(n.code,{children:"COPY"})," will fill in the appropriate values when the operation is run."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, if you have ",(0,s.jsx)(n.code,{children:"mytable"})," with the segments and mirror segments like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"contentid | dbid | file segment location \n    0     |  1   | /home/usr1/data1/gpsegdir0\n    0     |  3   | /home/usr1/data_mirror1/gpsegdir0 \n    1     |  4   | /home/usr1/data2/gpsegdir1\n    1     |  2   | /home/usr1/data_mirror2/gpsegdir1 \n"})}),"\n",(0,s.jsx)(n.p,{children:"running the command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY mytable TO '<SEG_DATA_DIR>/gpbackup<SEGID>.txt' ON SEGMENT;\n"})}),"\n",(0,s.jsx)(n.p,{children:"would result in the following files:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"/home/usr1/data1/gpsegdir0/gpbackup0.txt\n/home/usr1/data2/gpsegdir1/gpbackup1.txt\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The content ID in the first column is the identifier inserted into the file path (for example, ",(0,s.jsx)(n.code,{children:"gpsegdir0/gpbackup0.txt"})," above) Files are created on the segment hosts, rather than on the coordinator, as they would be in a standard ",(0,s.jsx)(n.code,{children:"COPY"})," operation. No data files are created for the mirror segments when using ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," copying."]}),"\n",(0,s.jsxs)(n.p,{children:["If an absolute path is specified, instead of ",(0,s.jsx)(n.code,{children:"<SEG_DATA_DIR>"}),", such as in the statement"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY mytable TO '/tmp/gpdir/gpbackup_<SEGID>.txt' ON SEGMENT;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["files would be placed in ",(0,s.jsx)(n.code,{children:"/tmp/gpdir"})," on every segment. The ",(0,s.jsx)(n.code,{children:"gpfdist"})," tool can also be used to restore data files generated with ",(0,s.jsx)(n.code,{children:"COPY TO"})," with the ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," option if redistribution is necessary."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," Tools such as ",(0,s.jsx)(n.code,{children:"gpfdist"})," can be used to restore data. The backup/restore tools will not work with files that were manually generated with ",(0,s.jsx)(n.code,{children:"COPY TO ON SEGMENT"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This example uses a ",(0,s.jsx)(n.code,{children:"SELECT"})," statement to copy data to files on each segment:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY (SELECT * FROM testtbl) TO '/tmp/mytst<SEGID>' ON SEGMENT;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This example copies the data from the ",(0,s.jsx)(n.code,{children:"lineitem"})," table and uses the ",(0,s.jsx)(n.code,{children:"PROGRAM"})," clause to add the data to the ",(0,s.jsx)(n.code,{children:"/tmp/lineitem_program.csv"})," file with ",(0,s.jsx)(n.code,{children:"cat"})," utility. The file is placed on the Cloudberry Database coordinator."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY LINEITEM TO PROGRAM 'cat > /tmp/lineitem.csv' CSV; \n"})}),"\n",(0,s.jsxs)(n.p,{children:["This example uses the ",(0,s.jsx)(n.code,{children:"PROGRAM"})," and ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clauses to copy data to files on the segment hosts. On the segment hosts, the ",(0,s.jsx)(n.code,{children:"COPY"})," command replaces ",(0,s.jsx)(n.code,{children:"<SEGID>"})," with the segment content ID to create a file for each segment instance on the segment host."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY LINEITEM TO PROGRAM 'cat > /tmp/lineitem_program<SEGID>.csv' ON SEGMENT CSV; \n"})}),"\n",(0,s.jsxs)(n.p,{children:["This example uses the ",(0,s.jsx)(n.code,{children:"PROGRAM"})," and ",(0,s.jsx)(n.code,{children:"ON SEGMENT"})," clauses to copy data from files on the segment hosts. The ",(0,s.jsx)(n.code,{children:"COPY"})," command replaces ",(0,s.jsx)(n.code,{children:"<SEGID>"})," with the segment content ID when copying data from the files. On the segment hosts, there must be a file for each segment instance where the file name contains the segment content ID on the segment host."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY LINEITEM_4 FROM PROGRAM 'cat /tmp/lineitem_program<SEGID>.csv' ON SEGMENT CSV;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"compatibility",children:"Compatibility"}),"\n",(0,s.jsxs)(n.p,{children:["There is no ",(0,s.jsx)(n.code,{children:"COPY"})," statement in the SQL standard."]}),"\n",(0,s.jsx)(n.p,{children:"The following syntax was used in earlier versions of Cloudberry Database and is still supported:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COPY <table_name> [(<column_name> [, ...])] FROM {'<filename>' | PROGRAM '<command>' | STDIN}\n\xa0\xa0\xa0\xa0\xa0[ [WITH]  \n       [ON SEGMENT]\n       [BINARY]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[OIDS]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[HEADER]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[DELIMITER [ AS ] '<delimiter_character>']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[NULL [ AS ] '<null string>']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[ESCAPE [ AS ] '<escape>' | 'OFF']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[NEWLINE [ AS ] 'LF' | 'CR' | 'CRLF']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[CSV [QUOTE [ AS ] '<quote>'] \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[FORCE NOT NULL <column_name> [, ...]]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0[FILL MISSING FIELDS]\n  \xa0\xa0\xa0\xa0\xa0[[LOG ERRORS]  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0SEGMENT REJECT LIMIT <count> [ROWS | PERCENT] ]\n\nCOPY { <table_name> [(<column_name> [, ...])] | (<query>)} TO {'<filename>' | PROGRAM '<command>' | STDOUT}\n\xa0\xa0\xa0\xa0\xa0\xa0[ [WITH] \n        [ON SEGMENT]\n        [BINARY]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[OIDS]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[HEADER]\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[DELIMITER [ AS ] 'delimiter_character']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[NULL [ AS ] 'null string']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[ESCAPE [ AS ] '<escape>' | 'OFF']\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[CSV [QUOTE [ AS ] 'quote'] \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[FORCE QUOTE <column_name> [, ...]] | * ]\n      [IGNORE EXTERNAL PARTITIONS ]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Note that in this syntax, ",(0,s.jsx)(n.code,{children:"BINARY"})," and ",(0,s.jsx)(n.code,{children:"CSV"})," are treated as independent keywords, not as arguments of a FORMAT option."]}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/docs/sql-stmts/create-external-table",children:"CREATE EXTERNAL TABLE"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>a});var s=t(67294);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);