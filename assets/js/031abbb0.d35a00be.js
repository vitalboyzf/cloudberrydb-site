"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[4336],{46808:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var l=s(85893),n=s(11151);const o={title:"Set Password Profile"},a="Set password policy in Cloudberry Database (New in v1.5.0)",i={id:"security/set-password-profile",title:"Set Password Profile",description:"Profile refers to the password policy configuration, which is used to control the password security policy of users in Cloudberry Database. You can bind a profile to one or more users to control the password security policy of database users. Profile defines the rules for user management and password reuse. With Profile, the database administrator can use SQL to force some constraints, such as locking accounts after login failures or controlling the number of password reuses.",source:"@site/docs/security/set-password-profile.md",sourceDirName:"security",slug:"/security/set-password-profile",permalink:"/docs/security/set-password-profile",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/docs/security/set-password-profile.md",tags:[],version:"current",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1740637488,formattedLastUpdatedAt:"Feb 27, 2025",frontMatter:{title:"Set Password Profile"},sidebar:"docsbars",previous:{title:"Protect Passwords",permalink:"/docs/security/protect-passwords"},next:{title:"Transparent Data Encryption",permalink:"/docs/security/transparent-data-encryption"}},t={},d=[{value:"Implementation principle",id:"implementation-principle",level:2},{value:"Set password policies using SQL",id:"set-password-policies-using-sql",level:2},{value:"CREATE PROFILE",id:"create-profile",level:3},{value:"ALTER PROFILE",id:"alter-profile",level:3},{value:"DROP PROFILE",id:"drop-profile",level:3},{value:"CREATE USER ... PROFILE",id:"create-user--profile",level:3},{value:"ALTER USER ... PROFILE",id:"alter-user--profile",level:3},{value:"CREATE USER ... ENABLE/DISABLE PROFILE",id:"create-user--enabledisable-profile",level:3},{value:"ALTER USER ... ENABLE/DISABLE PROFILE",id:"alter-user--enabledisable-profile",level:3},{value:"CREATE USER ... ACCOUNT LOCK/UNLOCK",id:"create-user--account-lockunlock",level:3},{value:"ALTER USER ... ACCOUNT LOCK/UNLOCK",id:"alter-user--account-lockunlock",level:3},{value:"Check password policy information in system tables",id:"check-password-policy-information-in-system-tables",level:2},{value:"Default password policy",id:"default-password-policy",level:2},{value:"Scenario examples",id:"scenario-examples",level:2},{value:"Create a password policy",id:"create-a-password-policy",level:3},{value:"Scenario 1: Set the maximum number of failed login attempts and password lock time",id:"scenario-1-set-the-maximum-number-of-failed-login-attempts-and-password-lock-time",level:3},{value:"Scenario 2: Set the number of historical password reuses",id:"scenario-2-set-the-number-of-historical-password-reuses",level:3},{value:"Scenario 3: Use DEFAULT PROFILE",id:"scenario-3-use-default-profile",level:3},{value:"Scenario 4: Superuser locks or unlocks user account",id:"scenario-4-superuser-locks-or-unlocks-user-account",level:3},{value:"Scenario 5: Enable Profile for regular users",id:"scenario-5-enable-profile-for-regular-users",level:3}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.h1,{id:"set-password-policy-in-cloudberry-database-new-in-v150",children:"Set password policy in Cloudberry Database (New in v1.5.0)"}),"\n",(0,l.jsx)(r.p,{children:"Profile refers to the password policy configuration, which is used to control the password security policy of users in Cloudberry Database. You can bind a profile to one or more users to control the password security policy of database users. Profile defines the rules for user management and password reuse. With Profile, the database administrator can use SQL to force some constraints, such as locking accounts after login failures or controlling the number of password reuses."}),"\n",(0,l.jsx)(r.admonition,{type:"info",children:(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:'In general, Profile includes password policy and user resource usage restrictions. Profile in Cloudberry Database only supports password policy. "Profile" mentioned in this document refers to password policy configuration.'}),"\n",(0,l.jsx)(r.li,{children:"Only superusers can create or modify Profile policies, and superusers are not restricted by any Profile policies. Profile policies will take effect only when regular users are allowed to use Profile."}),"\n"]})}),"\n",(0,l.jsxs)(r.p,{children:["The Profile feature is enabled by default. You can set the ",(0,l.jsx)(r.code,{children:"enable_password_profile"})," parameter in the ",(0,l.jsx)(r.code,{children:"postgresql.conf"})," file to disable or enable Profile. The default value of ",(0,l.jsx)(r.code,{children:"enable_password_profile"})," is ",(0,l.jsx)(r.code,{children:"true"}),"."]}),"\n",(0,l.jsxs)(r.p,{children:["To disable Profile and the related login monitor process, you can set ",(0,l.jsx)(r.code,{children:"enable_password_profile"})," to ",(0,l.jsx)(r.code,{children:"false"})," and restart the cluster:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"gpconfig -c enable_password_profile -v false\ngpstop -ra\n\n# To re-enable Profile, execute _gpconfig -c enable_password_profile -v true_ and restart the cluster.\n"})}),"\n",(0,l.jsx)(r.h2,{id:"implementation-principle",children:"Implementation principle"}),"\n",(0,l.jsx)(r.p,{children:"Similar to the Autovacuum mechanism, Profile introduces the Login Monitor Launcher and Login Monitor Worker processes. When user login verification fails, Cloudberry Database will send a signal to the postmaster. After receiving the signal, the postmaster will send a signal to the launcher process. After receiving the signal, the launcher process will notify the postmaster to launch a worker process to perform the metadata write-back operation, and notify the user process and the launcher process after completion."}),"\n",(0,l.jsx)(r.h2,{id:"set-password-policies-using-sql",children:"Set password policies using SQL"}),"\n",(0,l.jsx)(r.p,{children:"Database administrators can use SQL to set Profile. The following parameters are commonly used."}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:(0,l.jsx)(r.strong,{children:"Parameter"})}),(0,l.jsx)(r.th,{children:(0,l.jsx)(r.strong,{children:"Description"})})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"FAILED_LOGIN_ATTEMPTS"}),(0,l.jsxs)(r.td,{children:["\u2022 The maximum number of failed logins before the user account is locked.",(0,l.jsx)("br",{}),"\u2022 Valid values include ",(0,l.jsx)(r.code,{children:"-2"})," (unlimited), ",(0,l.jsx)(r.code,{children:"-1"})," (default), and ",(0,l.jsx)(r.code,{children:"1"})," to ",(0,l.jsx)(r.code,{children:"9999"}),".",(0,l.jsx)(r.code,{children:"0"})," is an invalid value."]})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"PASSWORD_LOCK_TIME"}),(0,l.jsxs)(r.td,{children:["\u2022 The lock time (in hours) after multiple consecutive failed login attempts. ",(0,l.jsx)("br",{}),"\u2022 Valid values are ",(0,l.jsx)(r.code,{children:"-2"})," to ",(0,l.jsx)(r.code,{children:"9999"}),". ",(0,l.jsx)(r.code,{children:"0"})," is a valid value."]})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"PASSWORD_REUSE_MAX"}),(0,l.jsxs)(r.td,{children:["\u2022 The number of historical password reuses.",(0,l.jsx)("br",{}),"\u2022 Valid values are ",(0,l.jsx)(r.code,{children:"-2"})," to ",(0,l.jsx)(r.code,{children:"9999"}),". ",(0,l.jsx)(r.code,{children:"0"})," is a valid value."]})]})]})]}),"\n",(0,l.jsx)(r.h3,{id:"create-profile",children:"CREATE PROFILE"}),"\n",(0,l.jsx)(r.p,{children:"Creates a profile and sets its password policy."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"CREATE PROFILE profile LIMIT\n  password_parameters ... ;\n\npassword_parameters:\n{ { FAILED_LOGIN_ATTEMPTS\n  | PASSWORD_REUSE_MAX\n  | PASSWORD_LOCK_TIME\n  }\n  expr\n}\n"})}),"\n",(0,l.jsx)(r.h3,{id:"alter-profile",children:"ALTER PROFILE"}),"\n",(0,l.jsx)(r.p,{children:"Modifies a password policy."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER PROFILE profile LIMIT\n   password_parameters ... ;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"drop-profile",children:"DROP PROFILE"}),"\n",(0,l.jsx)(r.p,{children:"Deletes a profile."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"DROP PROFILE profile;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"create-user--profile",children:"CREATE USER ... PROFILE"}),"\n",(0,l.jsx)(r.p,{children:"Creates a user and sets its profile."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"CREATE USER user PROFILE profile;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"alter-user--profile",children:"ALTER USER ... PROFILE"}),"\n",(0,l.jsxs)(r.p,{children:["Modifies the profile of ",(0,l.jsx)(r.code,{children:"user"}),"."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER user PROFILE profile;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"create-user--enabledisable-profile",children:"CREATE USER ... ENABLE/DISABLE PROFILE"}),"\n",(0,l.jsxs)(r.p,{children:["Creates a user and specifies their permission to use Profile. ",(0,l.jsx)(r.code,{children:"ENABLE PROFILE"})," grants permission, while ",(0,l.jsx)(r.code,{children:"DISABLE PROFILE"})," denies it. By default, newly created users are not permitted to use Profile."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"CREATE USER user\n  { ENABLE | DISABLE }\n  PROFILE;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"alter-user--enabledisable-profile",children:"ALTER USER ... ENABLE/DISABLE PROFILE"}),"\n",(0,l.jsx)(r.p,{children:"Sets whether a user is allowed to use Profile."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER user\n  { ENABLE | DISABLE }\n  PROFILE;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"create-user--account-lockunlock",children:"CREATE USER ... ACCOUNT LOCK/UNLOCK"}),"\n",(0,l.jsxs)(r.p,{children:["Creates a user and sets whether the user is locked. ",(0,l.jsx)(r.code,{children:"ACCOUNT LOCK"})," means that the user is locked and cannot  log in. ",(0,l.jsx)(r.code,{children:"ACCOUNT UNLOCK"})," means that the user is not locked and can log in. The default created user is not locked."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"CREATE USER user ACCOUNT\n  { LOCK | UNLOCK };\n"})}),"\n",(0,l.jsx)(r.h3,{id:"alter-user--account-lockunlock",children:"ALTER USER ... ACCOUNT LOCK/UNLOCK"}),"\n",(0,l.jsx)(r.p,{children:"Sets whether to lock the account of a user."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER user ACCOUNT\n  { LOCK | UNLOCK };\n"})}),"\n",(0,l.jsx)(r.h2,{id:"check-password-policy-information-in-system-tables",children:"Check password policy information in system tables"}),"\n",(0,l.jsxs)(r.p,{children:["After applying the password configuration policy, Cloudberry Database will update metadata: add two system tables ",(0,l.jsx)(r.code,{children:"pg_profile"})," and ",(0,l.jsx)(r.code,{children:"pg_password_history"}),", and add some fields to the system tables/views ",(0,l.jsx)(r.code,{children:"pg_authid"})," and ",(0,l.jsx)(r.code,{children:"pg_roles"}),". For example:"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"pg_catalog.pg_roles"}),": In ",(0,l.jsx)(r.code,{children:"pg_roles"}),", the ",(0,l.jsx)(r.code,{children:"rolprofile"}),", ",(0,l.jsx)(r.code,{children:"rolaccountstatus"}),", and ",(0,l.jsx)(r.code,{children:"rolfailedlogins"})," fields are added to record database users who use Profile, the account status, and the number of failed logins."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:'View "pg_catalog.pg_roles"\n    Column       |           Type           | Collation | Nullable | Default | Storage  | Description\n-------------------+--------------------------+-----------+----------+---------+----------+-------------\nrolname           | name                     |           |          |         | plain    |\nrolsuper          | boolean                  |           |          |         | plain    |\nrolinherit        | boolean                  |           |          |         | plain    |\nrolcreaterole     | boolean                  |           |          |         | plain    |\nrolcreatedb       | boolean                  |           |          |         | plain    |\nrolcanlogin       | boolean                  |           |          |         | plain    |\nrolreplication    | boolean                  |           |          |         | plain    |\nrolconnlimit      | integer                  |           |          |         | plain    |\nrolprofile        | name                     |           |          |         | plain    |\nrolaccountstatus  | smallint                 |           |          |         | plain    |\nrolfailedlogins   | integer                  |           |          |         | plain    |\nrolpassword       | text                     |           |          |         | extended |\nrolvaliduntil     | timestamp with time zone |           |          |         | plain    |\nrolbypassrls      | boolean                  |           |          |         | plain    |\nrolconfig         | text[]                   | C         |          |         | extended |\nrolresqueue       | oid                      |           |          |         | plain    |\noid               | oid                      |           |          |         | plain    |\nrolcreaterextgpfd | boolean                  |           |          |         | plain    |\nrolcreaterexthttp | boolean                  |           |          |         | plain    |\nrolcreatewextgpfd | boolean                  |           |          |         | plain    |\nrolresgroup       | oid                      |           |          |         | plain    |\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"pg_catalog.pg_authid"}),": In ",(0,l.jsx)(r.code,{children:"pg_authid"}),", the ",(0,l.jsx)(r.code,{children:"rolprofile"}),", ",(0,l.jsx)(r.code,{children:"rolaccountstatus"}),", ",(0,l.jsx)(r.code,{children:"rolfailedlogins"}),", ",(0,l.jsx)(r.code,{children:"rolpasswordsetat"}),", ",(0,l.jsx)(r.code,{children:"rollockdata"}),", and ",(0,l.jsx)(r.code,{children:"rolpasswordexpire"})," are added to record the database users who use Profile, the account status, the number of failed logins, password setting time, account lock time, and password expiration time."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:'Table "pg_catalog.pg_authid"\n    Column       |           Type           | Collation | Nullable | Default | Storage  | Compression | Stats target | Description\n-------------------+--------------------------+-----------+----------+---------+----------+-------------+--------------+-------------\noid               | oid                      |           | not null |         | plain    |             |              |\nrolname           | name                     |           | not null |         | plain    |             |              |\nrolsuper          | boolean                  |           | not null |         | plain    |             |              |\nrolinherit        | boolean                  |           | not null |         | plain    |             |              |\nrolcreaterole     | boolean                  |           | not null |         | plain    |             |              |\nrolcreatedb       | boolean                  |           | not null |         | plain    |             |              |\nrolcanlogin       | boolean                  |           | not null |         | plain    |             |              |\nrolreplication    | boolean                  |           | not null |         | plain    |             |              |\nrolbypassrls      | boolean                  |           | not null |         | plain    |             |              |\nrolconnlimit      | integer                  |           | not null |         | plain    |             |              |\nrolenableprofile  | boolean                  |           | not null |         | plain    |             |              |\nrolpassword       | text                     | C         |          |         | extended |             |              |\nrolvaliduntil     | timestamp with time zone |           |          |         | plain    |             |              |\nrolprofile        | oid                      |           | not null |         | plain    |             |              |\nrolaccountstatus  | smallint                 |           | not null |         | plain    |             |              |\nrolfailedlogins   | integer                  |           | not null |         | plain    |             |              |\nrolpasswordsetat  | timestamp with time zone |           |          |         | plain    |             |              |\nrollockdate       | timestamp with time zone |           |          |         | plain    |             |              |\nrolpasswordexpire | timestamp with time zone |           |          |         | plain    |             |              |\nrolresqueue       | oid                      |           |          |         | plain    |             |              |\nrolcreaterextgpfd | boolean                  |           |          |         | plain    |             |              |\nrolcreaterexthttp | boolean                  |           |          |         | plain    |             |              |\nrolcreatewextgpfd | boolean                  |           |          |         | plain    |             |              |\nrolresgroup       | oid                      |           |          |         | plain    |             |              |\nIndexes:\n    "pg_authid_oid_index" PRIMARY KEY, btree (oid), tablespace "pg_global"\n    "pg_authid_rolname_index" UNIQUE CONSTRAINT, btree (rolname), tablespace "pg_global"\n    "pg_authid_rolprofile_index" btree (rolprofile), tablespace "pg_global"\n    "pg_authid_rolresgroup_index" btree (rolresgroup), tablespace "pg_global"\n    "pg_authid_rolresqueue_index" btree (rolresqueue), tablespace "pg_global"\nTablespace: "pg_global"\nAccess method: heap\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"pg_catalog.pg_profile"})}),"\n",(0,l.jsxs)(r.p,{children:["The newly added ",(0,l.jsx)(r.code,{children:"pg_profile"})," system table is as follows:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:'Table "pg_catalog.pg_profile"\n        Column          |  Type   | Collation | Nullable | Default | Storage | Compression | Stats target | Description\n-------------------------+---------+-----------+----------+---------+---------+-------------+--------------+-------------\noid                     | oid     |           | not null |         | plain   |             |              |\nprfname                 | name    |           | not null |         | plain   |             |              |\nprffailedloginattempts  | integer |           | not null |         | plain   |             |              |\nprfpasswordlocktime     | integer |           | not null |         | plain   |             |              |\nprfpasswordlifetime     | integer |           | not null |         | plain   |             |              |\nprfpasswordgracetime    | integer |           | not null |         | plain   |             |              |\nprfpasswordreusetime    | integer |           | not null |         | plain   |             |              |\nprfpasswordreusemax     | integer |           | not null |         | plain   |             |              |\nprfpasswordallowhashed  | integer |           | not null |         | plain   |             |              |\nprfpasswordverifyfuncdb | oid     |           |          |         | plain   |             |              |\nprfpasswordverifyfunc   | oid     |           |          |         | plain   |             |              |\nIndexes:\n    "profile_name_index" UNIQUE CONSTRAINT, btree (prfname), tablespace "pg_global"\n    "profile_oid_index" UNIQUE CONSTRAINT, btree (oid), tablespace "pg_global"\n    "profile_password_verify_function_index" btree (prfpasswordverifyfuncdb, prfpasswordverifyfunc), tablespace "pg_global"\nTablespace: "pg_global"\nAccess method: heap\n'})}),"\n",(0,l.jsxs)(r.admonition,{type:"info",children:[(0,l.jsxs)(r.p,{children:["The fields in the ",(0,l.jsx)(r.code,{children:"pg_profile"})," table are described as follows:"]}),(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"oid"}),": used to uniquely identify each profile record."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"prfname"}),": the name of the configuration file."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"prffailedloginattempts"}),": the number of failed login attempts allowed before an account is locked."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"prfpasswordlocktime"}),": the password lock time. If an account is locked due to failed login attempts, this field defines how long the lock lasts."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"prfpasswordreusemax"}),": the number of new passwords that must be set before the old password can be reused."]}),"\n",(0,l.jsx)(r.li,{children:"Other fields in the table are not valid."}),"\n"]})]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"pg_catalog.pg_password_history"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:'Table "pg_catalog.pg_password_history"\n        Column         |           Type           | Collation | Nullable | Default | Storage  | Compression | Stats target | Description\n-----------------------+--------------------------+-----------+----------+---------+----------+-------------+--------------+-------------\npasshistroleid        | oid                      |           | not null |         | plain    |             |              |\npasshistpasswordsetat | timestamp with time zone |           | not null |         | plain    |             |              |\npasshistpassword      | text                     | C         | not null |         | extended |             |              |\nIndexes:\n    "pg_password_history_role_password_index" UNIQUE CONSTRAINT, btree (passhistroleid, passhistpassword), tablespace "pg_global"\n    "pg_password_history_role_passwordsetat_index" btree (passhistroleid, passhistpasswordsetat), tablespace "pg_global"\nTablespace: "pg_global"\nAccess method: heap\n'})}),"\n",(0,l.jsxs)(r.admonition,{type:"info",children:[(0,l.jsxs)(r.p,{children:["The fields in the ",(0,l.jsx)(r.code,{children:"pg_password_history"})," table are described as follows:"]}),(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"passhistroleid"}),": a unique ID that identifies the user or role related to this password history."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"passhistpasswordsetat"}),": a timestamp field with the time zone that records the exact time when the password was set or last modified."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"Passhistpassword"}),": the ciphertext that stores historical passwords."]}),"\n"]})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"default-password-policy",children:"Default password policy"}),"\n",(0,l.jsxs)(r.p,{children:["When you create a user, Cloudberry Database applies the default Profile to the user by default if no specific password policy is specified. The default Profile is the default password policy during system initialization. The default Profile in Cloudberry Database is the ",(0,l.jsx)(r.code,{children:"pg_default"})," row in the ",(0,l.jsx)(r.code,{children:"pg_profile"})," table. The ",(0,l.jsx)(r.code,{children:"pg_default"})," row defines default values for the Profile parameters, and only superusers can modify these parameters."]}),"\n",(0,l.jsxs)(r.p,{children:["If a user sets a parameter with the default value ",(0,l.jsx)(r.code,{children:"-1"}),", the parameter will get its value from ",(0,l.jsx)(r.code,{children:"pg_default"}),". The default values of ",(0,l.jsx)(r.code,{children:"pg_default"})," are as follows. Refer to ",(0,l.jsx)(r.a,{href:"#scenario-3-use-default-profile",children:"Scenario 3"})," for how to use the default Profile."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\x\nExpanded display is on.\n\n-- Checks the values of the default Profile in pg_profile\nSELECT * FROM pg_profile WHERE prfname = 'pg_default';\n-[ RECORD 1 ]-----------+-----------\noid                     | 10140\nprfname                 | pg_default\nprffailedloginattempts  | -2\nprfpasswordlocktime     | -2\nprfpasswordlifetime     | -2\nprfpasswordgracetime    | -2\nprfpasswordreusetime    | -2\nprfpasswordreusemax     | -2\nprfpasswordallowhashed  | 1\nprfpasswordverifyfuncdb |\nprfpasswordverifyfunc   |\n"})}),"\n",(0,l.jsx)(r.admonition,{type:"info",children:(0,l.jsxs)(r.p,{children:["The ",(0,l.jsx)(r.code,{children:"pg_default"})," row cannot be renamed or dropped by any user (including superusers)."]})}),"\n",(0,l.jsx)(r.h2,{id:"scenario-examples",children:"Scenario examples"}),"\n",(0,l.jsx)(r.p,{children:"This section introduces typical usage scenarios of Profile."}),"\n",(0,l.jsx)(r.h3,{id:"create-a-password-policy",children:"Create a password policy"}),"\n",(0,l.jsx)(r.p,{children:"Before creating a password policy, you need to create a profile first and bind a database user to the profile. For example:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"-- Creates a profile and a user.\nCREATE PROFILE myprofile;\nCREATE USER myuser PASSWORD 'mypassword';\n\n-- Binds the profile to the user.\nALTER USER myuser PROFILE myprofile;\n\n-- Checks the relationship between the user and the profile.\nSELECT rolname, rolprofile FROM pg_roles WHERE rolname = 'myuser';\n rolname | rolprofile\n---------+------------\n myuser  | myprofile\n(1 row)\n"})}),"\n",(0,l.jsx)(r.h3,{id:"scenario-1-set-the-maximum-number-of-failed-login-attempts-and-password-lock-time",children:"Scenario 1: Set the maximum number of failed login attempts and password lock time"}),"\n",(0,l.jsx)(r.p,{children:"Modify a Profile to set the maximum number of failed login attempts to 3 and the password lock time to 2 hours."}),"\n",(0,l.jsx)(r.admonition,{type:"info",children:(0,l.jsx)(r.p,{children:"When multiple users fail to log in, the result return speed may slow down."})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER PROFILE myprofile LIMIT\n  FAILED_LOGIN_ATTEMPTS 3\n  PASSWORD_LOCK_TIME 2;\n  \n-- Allows the user myuser to use Profile.\nALTER USER myuser ENABLE PROFILE;\n\n\n-- Checks the details in the catalog table (the pg_profile is the catalog table that stores all the details related to the user profile).\n-- Note that the time shown below is in seconds.\n\nSELECT prfname, prffailedloginattempts, prfpasswordlocktime\nFROM pg_profile\nWHERE prfname = 'myprofile';\n  prfname  | prffailedloginattempts | prfpasswordlocktime\n-----------+------------------------+---------------------\n myprofile |                      3 |                   2\n(1 row)\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate\n---------+------------+-----------------+-----------------+-------------\n myuser  | myprofile  | OPEN            |               0 |\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The current user ",(0,l.jsx)(r.code,{children:"myuser"})," does not have any login failures yet. The ",(0,l.jsx)(r.code,{children:"pg_roles"})," system table shows that the user's status is ",(0,l.jsx)(r.code,{children:"OPEN"}),", and the ",(0,l.jsx)(r.code,{children:"rolfailedlogins"})," field in the system table ",(0,l.jsx)(r.code,{children:"pg_roles"})," is ",(0,l.jsx)(r.code,{children:"0"}),". Now ",(0,l.jsx)(r.code,{children:"myuser"})," attempts a failed login and queries ",(0,l.jsx)(r.code,{children:"pg_roles"})," again."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\c - myuser\nPassword for user myuser:\nFATAL:  password authentication failed for user \"myuser\"\nPrevious connection kept\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate\n---------+------------+-----------------+-----------------+-------------\n myuser  | myprofile  | OPEN            |               1 |\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The above result shows that the user status is still ",(0,l.jsx)(r.code,{children:"OPEN"}),", and ",(0,l.jsx)(r.code,{children:"rolfailedlogins"})," have increased to ",(0,l.jsx)(r.code,{children:"1"}),". If the account fails to log in again, the ",(0,l.jsx)(r.code,{children:"rolfailedlogins"})," will continue to increase until the account is locked:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\c - myuser\nPassword for user myuser:\nFATAL:  role \"myuser\" is locked\nPrevious connection kept\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n---------+------------+-----------------+-----------------+----------------------------------\n myuser  | myprofile  | LOCKED(TIMED)   |               4 |13-MAR-23 12:25:50.811022 +08:00\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The user account is locked because of too many failed logins. The user status has changed to ",(0,l.jsx)(r.code,{children:"LOCKED(TIMED)"})," and the user account will be automatically unlocked after 2 hours (controlled by the ",(0,l.jsx)(r.code,{children:"PASSWORD_LOCK_TIME"})," parameter)."]}),"\n",(0,l.jsxs)(r.p,{children:["At the same time, the system records the timestamp of the user account lock. When the lock period expires, the user account's status will change back to ",(0,l.jsx)(r.code,{children:"OPEN"})," and login will be allowed. If the user fails to log in several times and the number of failures does not exceed the limit of ",(0,l.jsx)(r.code,{children:"FAILED_LOGIN_ATTEMPTS"}),", then the user can log in successfully, and the system will reset ",(0,l.jsx)(r.code,{children:"rolfailedlogins"})," to ",(0,l.jsx)(r.code,{children:"0"}),". See the following example:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\c - myuser\nPassword for user myuser:\nYou are now connected to database \"postgres\" as user \"myuser\".\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n---------+------------+-----------------+-----------------+----------------------------------\n myuser  | myprofile  | OPEN            |               0 |13-MAR-23 12:25:50.811022 +08:00\n(1 row)\n"})}),"\n",(0,l.jsx)(r.admonition,{type:"info",children:(0,l.jsxs)(r.p,{children:["If ",(0,l.jsx)(r.code,{children:"PASSWORD_LOCK_TIME"})," is manually set to ",(0,l.jsx)(r.code,{children:"0"}),", the user account will never be locked."]})}),"\n",(0,l.jsx)(r.h3,{id:"scenario-2-set-the-number-of-historical-password-reuses",children:"Scenario 2: Set the number of historical password reuses"}),"\n",(0,l.jsxs)(r.p,{children:["With the ",(0,l.jsx)(r.code,{children:"PASSWORD_REUSE_MAX"})," parameter, you can prevent users from setting recently used passwords. If you want to prevent users from using the last two historical passwords, you can use ",(0,l.jsx)(r.code,{children:"ALTER PROFILE"})," to modify this parameter. For example:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER PROFILE myprofile LIMIT\n  PASSWORD_REUSE_MAX 2;\n  \n-- Checks the Catalog table and finds that the number of permitted historical password reuses is 2.\n  SELECT prfname, prfpasswordreusemax\n  FROM pg_profile\n  WHERE prfname = 'myprofile';\n    prfname  | prfpasswordreusemax\n-----------+---------------------\n myprofile |                   2\n(1 row)\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER myuser PASSWORD 'mynewpassword';\n\nALTER USER myuser PASSWORD 'mypassword';\nERROR:  The new password should not be the same with latest 2 history password\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The above result shows that ",(0,l.jsx)(r.code,{children:"mypassword"})," is not allowed to be reused as a new password because it has been used before. To set a new password, make sure that two different in-between passwords have been set before reusing an old password."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER myuser PASSWORD 'mypassword2'; -- Second password change\nALTER USER myuser PASSWORD 'mypassword';\n"})}),"\n",(0,l.jsx)(r.admonition,{type:"info",children:(0,l.jsxs)(r.p,{children:["If ",(0,l.jsx)(r.code,{children:"PASSWORD_REUSE_MAX"})," is set to ",(0,l.jsx)(r.code,{children:"0"}),", the password can never be changed. If set to ",(0,l.jsx)(r.code,{children:"-2"}),"(",(0,l.jsx)(r.code,{children:"UNLIMITED"}),"), the history password can only be used after ",(0,l.jsx)(r.code,{children:"9999"})," passwords have been set."]})}),"\n",(0,l.jsx)(r.h3,{id:"scenario-3-use-default-profile",children:"Scenario 3: Use DEFAULT PROFILE"}),"\n",(0,l.jsxs)(r.p,{children:["If you do not explicitly specify a parameter value when creating a profile, the parameter value  in the ",(0,l.jsx)(r.code,{children:"pg_profile"})," table is ",(0,l.jsx)(r.code,{children:"-1"})," by default, which means that Cloudberry Database will obtain the value of this parameter from ",(0,l.jsx)(r.code,{children:"pg_default"}),"."]}),"\n",(0,l.jsxs)(r.p,{children:["Take ",(0,l.jsx)(r.code,{children:"FAILED_LOGIN_ATTEMPTS"})," as an example:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"--Creates a profile without explicitly specifying any parameter values.\nCREATE PROFILE myprf;\n\n-- Checks the default parameter value of myprf in pg_profile.\n\nSELECT * FROM pg_profile WHERE prfname = 'myprf';\n-[ RECORD 1 ]-----------+------\noid                     | 16386\nprfname                 | myprf\nprffailedloginattempts  | -1\nprfpasswordlocktime     | -1\nprfpasswordlifetime     | -1\nprfpasswordgracetime    | -1\nprfpasswordreusetime    | -1\nprfpasswordreusemax     | -1\nprfpasswordallowhashed  | -1\nprfpasswordverifyfuncdb |\nprfpasswordverifyfunc   |\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The above example creates a profile named ",(0,l.jsx)(r.code,{children:"myprf"}),". Because no parameter values are set explicitly, all parameter values are ",(0,l.jsx)(r.code,{children:"-1"})," by default, which means that any user bound to this profile will use the parameter values in ",(0,l.jsx)(r.code,{children:"pg_default"}),"."]}),"\n",(0,l.jsxs)(r.p,{children:["The following example sets the ",(0,l.jsx)(r.code,{children:"FAILED_LOGIN_ATTEMPTS"})," parameter of ",(0,l.jsx)(r.code,{children:"pg_defau``lt"})," to ",(0,l.jsx)(r.code,{children:"1"})," and creates a test."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"-- Sets the default value of FAILED_LOGIN_ATTEMPTS in pg_default to 1.\n-- All users who do not specify a profile will have their accounts locked after a failed login.\n\nALTER PROFILE pg_default LIMIT FAILED_LOGIN_ATTEMPTS 1;\n\\x\nExpanded display is on.\n\n-- Checks the default value of pg_default in pg_profile.\nSELECT * FROM pg_profile WHERE prfname = 'pg_default';\n-[ RECORD 1 ]-----------+-----------\noid                     | 10140\nprfname                 | pg_default\nprffailedloginattempts  | 1\nprfpasswordlocktime     | -2\nprfpasswordlifetime     | -2\nprfpasswordgracetime    | -2\nprfpasswordreusetime    | -2\nprfpasswordreusemax     | -2\nprfpasswordallowhashed  | 1\nprfpasswordverifyfuncdb |\nprfpasswordverifyfunc   |\n\nCREATE USER mynewuser PASSWORD 'mynewpassword' ENABLE PROFILE;\n\nSELECT rolname, rolprofile, get_role_status('mynewuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'mynewuser';\n  rolname  | rolprofile | get_role_status | rolfailedlogins | rollockdate\n-----------+------------+-----------------+-----------------+-------------\n mynewuser | pg_default | OPEN            |               0 |\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["From the above result, you can see that the user's profile is ",(0,l.jsx)(r.code,{children:"pg_default"})," and the user account status is ",(0,l.jsx)(r.code,{children:"OPEN"}),". Next, try logging into the account using a wrong password."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\c - mynewuser\nPassword for user mynewuser:\nFATAL:  password authentication failed for user \"mynewuser\"\nPrevious connection kept\n\nSELECT rolname, rolprofile, get_role_status('mynewuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'mynewuser';\n  rolname  | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n-----------+------------+---------------------+-----------------+----------------------------------\n mynewuser | pg_default | LOCKED(TIMED)   |               1 | 12-MAR-23 09:36:42.132231 +08:00\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["Because ",(0,l.jsx)(r.code,{children:"FAILED_LOGIN_ATTEMPTS"})," of ",(0,l.jsx)(r.code,{children:"pg_default"})," is ",(0,l.jsx)(r.code,{children:"1"}),", the account is locked after one failed login."]}),"\n",(0,l.jsxs)(r.p,{children:["Next, set the user's profile to ",(0,l.jsx)(r.code,{children:"myprf"}),", and then test the same operation to observe the result. The user needs to be unlocked before the test."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER mynewuser ACCOUNT unlock PROFILE myprf;\n\nSELECT rolname, rolprofile, get_role_status('mynewuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'mynewuser';\n  rolname  | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n-----------+------------+---------------------+-----------------+----------------------------------\n mynewuser | myprf      | OPEN            |               0 | 12-MAR-23 09:36:42.132231 +08:00\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["The result shows that the user status changes back to ",(0,l.jsx)(r.code,{children:"OPEN"})," and the profile changes to ",(0,l.jsx)(r.code,{children:"myprf"}),". ",(0,l.jsx)(r.code,{children:"rollockdate"})," still exists as expected. Next, use a wrong password to log in again and observe the returned result."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"\\c - mynewuser\nPassword for user mynewuser:\nFATAL:  password authentication failed for user \"mynewuser\"\nPrevious connection kept\n\nSELECT rolname, rolprofile, get_role_status('mynewuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'mynewuser';\n  rolname  | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n-----------+------------+---------------------+-----------------+----------------------------------\n mynewuser | myprf      | LOCKED(TIMED)   |               1 | 12-MAR-23 09:38:26.753832 +08:00\n(1 row)\n"})}),"\n",(0,l.jsx)(r.p,{children:"As expected, the user account status is locked again."}),"\n",(0,l.jsx)(r.h3,{id:"scenario-4-superuser-locks-or-unlocks-user-account",children:"Scenario 4: Superuser locks or unlocks user account"}),"\n",(0,l.jsx)(r.p,{children:"A superuser can lock or unlock a user account. For example:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER myuser ACCOUNT LOCK;\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n---------+------------+---------------------+-----------------+----------------------------------\n myuser  | myprofile  | LOCKED          |               0 | 13-MAR-23 12:25:50.811022 +08:00\n(1 row)\n\nALTER USER myuser ACCOUNT UNLOCK;\n\nSELECT rolname, rolprofile, get_role_status('myuser'), rolfailedlogins, rollockdate\nFROM pg_roles\nWHERE rolname = 'myuser';\n rolname | rolprofile | get_role_status | rolfailedlogins |           rollockdate            \n---------+------------+---------------------+-----------------+----------------------------------\n myuser  | myprofile  | OPEN            |               0 | 13-MAR-23 13:23:50.83928 +08:00\n(1 row)\n"})}),"\n",(0,l.jsx)(r.h3,{id:"scenario-5-enable-profile-for-regular-users",children:"Scenario 5: Enable Profile for regular users"}),"\n",(0,l.jsx)(r.p,{children:"By default, a newly created regular user is not bound to a Profile. To use Profile, you need to specify it explicitly. See the following example:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"CREATE USER myuser1;\n\nSELECT rolname, rolprofile, get_role_status('myuser1'), rolfailedlogins, rollockdate, rolenableprofile\nFROM pg_roles\nWHERE rolname like 'myuser1';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate | rolenableprofile\n---------+------------+-----------------+-----------------+-------------+------------------\n myuser1 | pg_default | OPEN            |               0 |             | f\n(1 row)\n\nCREATE USER myuser2 ENABLE PROFILE;\nSELECT rolname, rolprofile, get_role_status('myuser2'), rolfailedlogins, rollockdate, rolenableprofile\nFROM pg_roles\nWHERE rolname = 'myuser2';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate | rolenableprofile\n---------+------------+-----------------+-----------------+-------------+------------------\n myuser2 | pg_default | OPEN            |               0 |             | t\n(1 row)\n\nCREATE USER myuser3 DISABLE PROFILE;\nSELECT rolname, rolprofile, get_role_status('myuser3'), rolfailedlogins, rollockdate, rolenableprofile\nFROM pg_roles\nWHERE rolname = 'myuser3';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate | rolenableprofile\n---------+------------+-----------------+-----------------+-------------+------------------\n myuser3 | pg_default | OPEN            |               0 |             | f\n(1 row)\n"})}),"\n",(0,l.jsxs)(r.p,{children:["After creating a user, you can modify whether to use Profile through the SQL statement ",(0,l.jsx)(r.code,{children:"ALTER USER ENABLE/DISABLE PROFILE"}),"."]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-sql",children:"ALTER USER myuser1 ENABLE PROFILE;\n\nSELECT rolname, rolprofile, get_role_status('myuser1'), rolfailedlogins, rollockdate, rolenableprofile\nFROM pg_roles\nWHERE rolname = 'myuser1';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate | rolenableprofile\n---------+------------+-----------------+-----------------+-------------+------------------\n myuser1 | pg_default | OPEN            |               0 |             | t\n(1 row)\n\nALTER USER myuser1 DISABLE PROFILE;\nSELECT rolname, rolprofile, get_role_status('myuser1'), rolfailedlogins, rollockdate, rolenableprofile\nFROM pg_roles\nWHERE rolname = 'myuser1';\n rolname | rolprofile | get_role_status | rolfailedlogins | rollockdate | rolenableprofile\n---------+------------+-----------------+-----------------+-------------+------------------\n myuser1 | pg_default | OPEN            |               0 |             | f\n(1 row)\n"})})]})}function p(e={}){const{wrapper:r}={...(0,n.a)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},11151:(e,r,s)=>{s.d(r,{Z:()=>i,a:()=>a});var l=s(67294);const n={},o=l.createContext(n);function a(e){const r=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),l.createElement(o.Provider,{value:r},e.children)}}}]);